{"version":3,"names":["atomicProductMultiValueTextCss","AtomicProductMultiValueTextStyle0","AtomicProductMultiValueText","this","maxValuesToDisplay","delimiter","sortedValues","initialize","bindings","interfaceElement","type","searchOrListing","buildProductListing","engine","buildSearch","breadcrumbManager","productValues","value","ProductTemplatesHelpers","getProductProperty","product","field","Array","isArray","map","v","trim","error","Error","split","facetSelectedValues","state","facetBreadcrumbs","filter","facet","reduce","values","updateSortedValues","allValues","firstValues","includes","from","Set","getShouldDisplayLabel","length","getNumberOfValuesToDisplay","Math","min","renderValue","label","getFieldValueCaption","i18n","kebabValue","titleToKebab","h","key","part","name","renderSeparator","beforeValue","afterValue","class","renderMoreLabel","t","renderListItems","numberOfValuesToDisplay","nodes","i","push","componentWillRender","render","host","remove","__decorate","InitializeBindings","ProductContext"],"sources":["src/components/commerce/product-template-components/atomic-product-multi-value-text/atomic-product-multi-value-text.pcss?tag=atomic-product-multi-value-text&encapsulation=shadow","src/components/commerce/product-template-components/atomic-product-multi-value-text/atomic-product-multi-value-text.tsx"],"sourcesContent":[":host {\n  > ul {\n    display: flex;\n    list-style: none;\n    margin: 0;\n    padding: 0;\n\n    li {\n      display: inline-block;\n    }\n  }\n}\n\n.separator {\n  &::before {\n    display: inline;\n    content: ',\\00a0';\n  }\n}\n","import {\n  BreadcrumbManager,\n  buildProductListing,\n  buildSearch,\n  Product,\n  ProductListing,\n  ProductTemplatesHelpers,\n  Search,\n  RegularFacetValue,\n} from '@coveo/headless/commerce';\nimport {Component, Element, Prop, h, State, VNode} from '@stencil/core';\nimport {getFieldValueCaption} from '../../../../utils/field-utils';\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\nimport {titleToKebab} from '../../../../utils/utils';\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport {ProductContext} from '../product-template-decorators';\n\n/**\n * @alpha\n *\n * The `atomic-product-multi-value-text` component renders the values of a multi-value string field.\n * @part product-multi-value-text-list - The list of field values.\n * @part product-multi-value-text-separator - The separator to display between each of the field values.\n * @part product-multi-value-text-value - A field value.\n * @part product-multi-value-text-value-more - A label indicating some values were omitted.\n * @slot product-multi-value-text-value-* - A custom caption value that's specified for a given part of a multi-text field value. For example, if you want to use `Off-Campus Resident` as a caption value for `Off-campus apartment` in `Off-campus apartment;On-campus apartment`, you'd use `<span slot=\"product-multi-value-text-value-off-campus-apartment\">Off-Campus Resident</span>`). The suffix of this slot corresponds with the field value, written in kebab case.\n */\n@Component({\n  tag: 'atomic-product-multi-value-text',\n  styleUrl: 'atomic-product-multi-value-text.pcss',\n  shadow: true,\n})\nexport class AtomicProductMultiValueText {\n  public breadcrumbManager!: BreadcrumbManager;\n  public searchOrListing!: Search | ProductListing;\n\n  @InitializeBindings() public bindings!: CommerceBindings;\n  @ProductContext() private product!: Product;\n\n  @Element() host!: HTMLElement;\n\n  @State() public error!: Error;\n\n  /**\n   * The field that the component should use.\n   * The component will try to find this field in the `Product.additionalFields` object unless it finds it in the `Product` object first.\n   * Make sure this field is present in the `fieldsToInclude` property of the `atomic-commerce-interface` component.\n   */\n  @Prop({reflect: true}) public field!: string;\n\n  /**\n   * The maximum number of field values to display.\n   * If there are _n_ more values than the specified maximum, the last displayed value will be \"_n_ more...\".\n   */\n  @Prop({reflect: true}) public maxValuesToDisplay = 3;\n\n  /**\n   * The delimiter used to separate values when the field isn't indexed as a multi value field.\n   */\n  @Prop({reflect: true}) public delimiter: string | null = null;\n\n  private sortedValues: string[] | null = null;\n\n  public initialize() {\n    if (this.bindings.interfaceElement.type === 'product-listing') {\n      this.searchOrListing = buildProductListing(this.bindings.engine);\n    } else {\n      this.searchOrListing = buildSearch(this.bindings.engine);\n    }\n\n    this.breadcrumbManager = this.searchOrListing.breadcrumbManager();\n  }\n\n  private get productValues() {\n    const value = ProductTemplatesHelpers.getProductProperty(\n      this.product,\n      this.field\n    );\n\n    if (value === null) {\n      return null;\n    }\n\n    if (Array.isArray(value)) {\n      return value.map((v) => `${v}`.trim());\n    }\n\n    if (typeof value !== 'string' || value.trim() === '') {\n      this.error = new Error(\n        `Could not parse \"${value}\" from field \"${this.field}\" as a string array.`\n      );\n      return null;\n    }\n\n    return this.delimiter\n      ? value.split(this.delimiter).map((value) => value.trim())\n      : [value];\n  }\n\n  private get facetSelectedValues() {\n    return this.breadcrumbManager.state.facetBreadcrumbs\n      .filter((facet) => facet.field === this.field)\n      .reduce(\n        (values, facet) => [\n          ...values,\n          ...facet.values.map(({value}) => (value as RegularFacetValue).value),\n        ],\n        [] as string[]\n      );\n  }\n\n  private updateSortedValues() {\n    const allValues = this.productValues;\n    if (allValues === null) {\n      this.sortedValues = null;\n      return;\n    }\n    const firstValues = this.facetSelectedValues.filter((value) =>\n      allValues.includes(value)\n    );\n    this.sortedValues = Array.from(new Set([...firstValues, ...allValues]));\n  }\n\n  private getShouldDisplayLabel(values: string[]) {\n    return (\n      this.maxValuesToDisplay > 0 && values.length > this.maxValuesToDisplay\n    );\n  }\n\n  private getNumberOfValuesToDisplay(values: string[]) {\n    return Math.min(values.length, this.maxValuesToDisplay);\n  }\n\n  private renderValue(value: string) {\n    const label = getFieldValueCaption(this.field, value, this.bindings.i18n);\n    const kebabValue = titleToKebab(value);\n    return (\n      <li key={value} part=\"product-multi-value-text-value\">\n        <slot name={`product-multi-value-text-value-${kebabValue}`}>\n          {label}\n        </slot>\n      </li>\n    );\n  }\n\n  private renderSeparator(beforeValue: string, afterValue: string) {\n    return (\n      <li\n        aria-hidden=\"true\"\n        part=\"product-multi-value-text-separator\"\n        key={`${beforeValue}~${afterValue}`}\n        class=\"separator\"\n      ></li>\n    );\n  }\n\n  private renderMoreLabel(value: number) {\n    return (\n      <li key=\"more-field-values\" part=\"product-multi-value-text-value-more\">\n        {this.bindings.i18n.t('n-more', {value})}\n      </li>\n    );\n  }\n\n  private renderListItems(values: string[]) {\n    const numberOfValuesToDisplay = this.getNumberOfValuesToDisplay(values);\n\n    const nodes: VNode[] = [];\n    for (let i = 0; i < numberOfValuesToDisplay; i++) {\n      if (i > 0) {\n        nodes.push(this.renderSeparator(values[i - 1], values[i]));\n      }\n      nodes.push(this.renderValue(values[i]));\n    }\n    if (this.getShouldDisplayLabel(values)) {\n      nodes.push(\n        this.renderSeparator(\n          values[numberOfValuesToDisplay - 1],\n          'more-field-values'\n        )\n      );\n      nodes.push(this.renderMoreLabel(values.length - numberOfValuesToDisplay));\n    }\n    return nodes;\n  }\n\n  public componentWillRender() {\n    this.updateSortedValues();\n  }\n\n  public render() {\n    if (this.sortedValues === null) {\n      this.host.remove();\n      return;\n    }\n    return (\n      <ul part=\"product-multi-value-text-list\">\n        {...this.renderListItems(this.sortedValues)}\n      </ul>\n    );\n  }\n}\n"],"mappings":"udAAA,MAAMA,EAAiC,iJACvC,MAAAC,EAAeD,E,iXC+BFE,EAA2B,M,yBAsBRC,KAAAC,mBAAqB,EAKrBD,KAAAE,UAA2B,KAEjDF,KAAAG,aAAgC,K,kEAPW,E,eAKM,I,CAIlD,UAAAC,GACL,GAAIJ,KAAKK,SAASC,iBAAiBC,OAAS,kBAAmB,CAC7DP,KAAKQ,gBAAkBC,EAAoBT,KAAKK,SAASK,O,KACpD,CACLV,KAAKQ,gBAAkBG,EAAYX,KAAKK,SAASK,O,CAGnDV,KAAKY,kBAAoBZ,KAAKQ,gBAAgBI,mB,CAGhD,iBAAYC,GACV,MAAMC,EAAQC,EAAwBC,mBACpChB,KAAKiB,QACLjB,KAAKkB,OAGP,GAAIJ,IAAU,KAAM,CAClB,OAAO,I,CAGT,GAAIK,MAAMC,QAAQN,GAAQ,CACxB,OAAOA,EAAMO,KAAKC,GAAM,GAAGA,IAAIC,Q,CAGjC,UAAWT,IAAU,UAAYA,EAAMS,SAAW,GAAI,CACpDvB,KAAKwB,MAAQ,IAAIC,MACf,oBAAoBX,kBAAsBd,KAAKkB,6BAEjD,OAAO,I,CAGT,OAAOlB,KAAKE,UACRY,EAAMY,MAAM1B,KAAKE,WAAWmB,KAAKP,GAAUA,EAAMS,SACjD,CAACT,E,CAGP,uBAAYa,GACV,OAAO3B,KAAKY,kBAAkBgB,MAAMC,iBACjCC,QAAQC,GAAUA,EAAMb,QAAUlB,KAAKkB,QACvCc,QACC,CAACC,EAAQF,IAAU,IACdE,KACAF,EAAME,OAAOZ,KAAI,EAAEP,WAAYA,EAA4BA,UAEhE,G,CAIE,kBAAAoB,GACN,MAAMC,EAAYnC,KAAKa,cACvB,GAAIsB,IAAc,KAAM,CACtBnC,KAAKG,aAAe,KACpB,M,CAEF,MAAMiC,EAAcpC,KAAK2B,oBAAoBG,QAAQhB,GACnDqB,EAAUE,SAASvB,KAErBd,KAAKG,aAAegB,MAAMmB,KAAK,IAAIC,IAAI,IAAIH,KAAgBD,I,CAGrD,qBAAAK,CAAsBP,GAC5B,OACEjC,KAAKC,mBAAqB,GAAKgC,EAAOQ,OAASzC,KAAKC,kB,CAIhD,0BAAAyC,CAA2BT,GACjC,OAAOU,KAAKC,IAAIX,EAAOQ,OAAQzC,KAAKC,mB,CAG9B,WAAA4C,CAAY/B,GAClB,MAAMgC,EAAQC,EAAqB/C,KAAKkB,MAAOJ,EAAOd,KAAKK,SAAS2C,MACpE,MAAMC,EAAaC,EAAapC,GAChC,OACEqC,EAAA,MAAIC,IAAKtC,EAAOuC,KAAK,kCACnBF,EAAA,QAAMG,KAAM,kCAAkCL,KAC3CH,G,CAMD,eAAAS,CAAgBC,EAAqBC,GAC3C,OACEN,EAAA,oBACc,OACZE,KAAK,qCACLD,IAAK,GAAGI,KAAeC,IACvBC,MAAM,a,CAKJ,eAAAC,CAAgB7C,GACtB,OACEqC,EAAA,MAAIC,IAAI,oBAAoBC,KAAK,uCAC9BrD,KAAKK,SAAS2C,KAAKY,EAAE,SAAU,CAAC9C,U,CAK/B,eAAA+C,CAAgB5B,GACtB,MAAM6B,EAA0B9D,KAAK0C,2BAA2BT,GAEhE,MAAM8B,EAAiB,GACvB,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAyBE,IAAK,CAChD,GAAIA,EAAI,EAAG,CACTD,EAAME,KAAKjE,KAAKuD,gBAAgBtB,EAAO+B,EAAI,GAAI/B,EAAO+B,I,CAExDD,EAAME,KAAKjE,KAAK6C,YAAYZ,EAAO+B,I,CAErC,GAAIhE,KAAKwC,sBAAsBP,GAAS,CACtC8B,EAAME,KACJjE,KAAKuD,gBACHtB,EAAO6B,EAA0B,GACjC,sBAGJC,EAAME,KAAKjE,KAAK2D,gBAAgB1B,EAAOQ,OAASqB,G,CAElD,OAAOC,C,CAGF,mBAAAG,GACLlE,KAAKkC,oB,CAGA,MAAAiC,GACL,GAAInE,KAAKG,eAAiB,KAAM,CAC9BH,KAAKoE,KAAKC,SACV,M,CAEF,OACElB,EAAA,MAAIE,KAAK,oCACHrD,KAAK6D,gBAAgB7D,KAAKG,c,6BAjKPmE,EAAA,CAA5BC,K,+BACyBD,EAAA,CAAzBE,K","ignoreList":[]}