{"version":3,"names":["atomicPopoverCss","AtomicPopoverStyle0","AtomicPopover","this","isOpen","initialize","searchStatus","buildSearchStatus","bindings","engine","host","children","length","error","Error","initializePopover","event","childFacet","detail","element","classList","add","popoverClass","handleKeyDown","e","key","togglePopover","popoverId","facetId","label","componentDidRender","popperInstance","buttonRef","popupRef","createPopper","placement","modifiers","preventOverflow","componentDidUpdate","forceUpdate","renderDropdownButton","hasActiveValues","numberOfActiveValues","count","toLocaleString","i18n","language","ariaLabel","t","h","Button","ref","el","style","onClick","part","ariaExpanded","ariaControls","class","title","text","icon","ArrowBottomIcon","renderBackdrop","renderPopover","id","render","state","hasError","Hidden","firstSearchExecuted","hasResults","hasValues","Host","source","container","active","shouldHideSelf","__decorate","InitializeBindings","BindStateToController"],"sources":["src/components/search/facets/atomic-popover/atomic-popover.pcss?tag=atomic-popover&encapsulation=shadow","src/components/search/facets/atomic-popover/atomic-popover.tsx"],"sourcesContent":["@import '../../../common/facets/facet-common.pcss';\n","import {\n  buildSearchStatus,\n  SearchStatus,\n  SearchStatusState,\n  FacetState,\n} from '@coveo/headless';\nimport {\n  createPopperLite as createPopper,\n  preventOverflow,\n  Instance as PopperInstance,\n} from '@popperjs/core';\nimport {Component, h, Listen, State, Element, Host} from '@stencil/core';\nimport ArrowBottomIcon from '../../../../images/arrow-bottom-rounded.svg';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {\n  PopoverChildFacet,\n  popoverClass,\n} from '../../../common/facets/popover/popover-type';\nimport {Button} from '../../../common/stencil-button';\nimport {Hidden} from '../../../common/stencil-hidden';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\n\n/**\n * The `atomic-popover` component displays any facet as a popover menu.\n *\n * @slot default - The required slotted facet.\n * @part backdrop - The transparent backdrop hiding the content behind popover menu.\n * @part popover-button - The button to click to display or hide the popover menu.\n * @part value-label - The associated facet label.\n * @part value-count - Number of selected values for the facet\n * @part arrow-icon - The arrow icon on the button to display or hide the popover menu.\n * @part placeholder - The placeholder displayed when the facet is loading.\n * @part facet - The wrapper that contains the slotted 'facet'.\n */\n@Component({\n  tag: 'atomic-popover',\n  styleUrl: 'atomic-popover.pcss',\n  shadow: true,\n})\nexport class AtomicPopover implements InitializableComponent {\n  @Element() private host!: HTMLElement;\n  private buttonRef!: HTMLElement;\n  private popupRef!: HTMLElement;\n  private popperInstance?: PopperInstance;\n  @InitializeBindings()\n  public bindings!: Bindings;\n  private searchStatus!: SearchStatus;\n\n  @BindStateToController('searchStatus')\n  @State()\n  public searchStatusState!: SearchStatusState;\n  @BindStateToController('facet')\n  @State()\n  public facetState!: FacetState;\n  @State()\n  public error!: Error;\n  @State() private isOpen = false;\n  @State() private childFacet?: PopoverChildFacet;\n\n  public initialize() {\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\n\n    if (this.host.children.length === 0) {\n      this.error = new Error(\n        'One child is required inside a set of popover tags.'\n      );\n\n      return;\n    }\n\n    if (this.host.children.length > 1) {\n      this.error = new Error(\n        'Cannot have more than one child inside a set of popover tags.'\n      );\n    }\n  }\n\n  @Listen('atomic/initializePopover')\n  public initializePopover(event: CustomEvent<PopoverChildFacet>) {\n    if (this.childFacet || !event.detail) {\n      return;\n    }\n\n    this.childFacet = event.detail;\n    this.childFacet.element.classList.add(popoverClass);\n  }\n\n  @Listen('keydown')\n  public handleKeyDown(e: KeyboardEvent) {\n    if (e.key === 'Escape' && this.isOpen) {\n      this.togglePopover();\n    }\n  }\n\n  private get popoverId() {\n    return `${this.childFacet?.facetId}-popover`;\n  }\n\n  private get label() {\n    return this.childFacet!.label();\n  }\n\n  private togglePopover() {\n    this.isOpen = !this.isOpen;\n  }\n\n  public componentDidRender() {\n    if (this.popperInstance || !this.buttonRef || !this.popupRef) {\n      return;\n    }\n\n    this.popperInstance = createPopper(this.buttonRef, this.popupRef, {\n      placement: 'bottom-start',\n      modifiers: [preventOverflow],\n    });\n  }\n\n  public componentDidUpdate() {\n    this.popperInstance?.forceUpdate();\n  }\n\n  private renderDropdownButton() {\n    const label = this.label;\n    const hasActiveValues = !!this.childFacet!.numberOfActiveValues();\n    const count = this.childFacet!.numberOfActiveValues().toLocaleString(\n      this.bindings.i18n.language\n    );\n    const ariaLabel = this.bindings.i18n.t('popover', {label});\n\n    return (\n      <Button\n        ref={(el) => (this.buttonRef = el!)}\n        style=\"square-neutral\"\n        onClick={() => this.togglePopover()}\n        part=\"popover-button\"\n        ariaExpanded={`${this.isOpen}`}\n        ariaLabel={ariaLabel}\n        ariaControls={this.popoverId}\n        class={`hover:border-primary-light focus-visible:border-primary-light group box-border flex h-full max-w-60 min-w-24 items-center rounded p-2.5 hover:border focus-visible:border ${\n          this.isOpen\n            ? 'border-primary ring-ring-primary text-primary z-9999 ring-3'\n            : ''\n        }`}\n      >\n        <span\n          title={label}\n          part=\"value-label\"\n          class={`mr-1.5 truncate ${\n            this.isOpen\n              ? ''\n              : 'group-hover:text-primary-light group-focus:text-primary'\n          }`}\n        >\n          {label}\n        </span>\n        <span\n          part=\"value-count\"\n          class={`group-hover:text-primary-light group-focus:text-primary mr-1.5 truncate text-sm ${\n            hasActiveValues ? '' : 'hidden'\n          } ${this.isOpen ? 'text-primary' : 'text-neutral-dark'}`}\n        >\n          {this.bindings.i18n.t('between-parentheses', {\n            text: count,\n          })}\n        </span>\n        <atomic-icon\n          part=\"arrow-icon\"\n          class={`group-hover:text-primary-light group-focus:text-primary ml-auto w-2 ${\n            this.isOpen ? 'rotate-180' : ''\n          } `}\n          icon={ArrowBottomIcon}\n        ></atomic-icon>\n      </Button>\n    );\n  }\n\n  private renderBackdrop() {\n    return (\n      <div\n        part=\"backdrop\"\n        class=\"fixed top-0 right-0 bottom-0 left-0 z-9998 cursor-pointer bg-transparent\"\n        onClick={() => this.togglePopover()}\n      ></div>\n    );\n  }\n\n  private renderPopover() {\n    return (\n      <div class={`relative ${this.isOpen ? 'z-9999' : ''}`}>\n        {this.renderDropdownButton()}\n        <div\n          id={this.popoverId}\n          ref={(el) => (this.popupRef = el!)}\n          part=\"facet\"\n          class={`absolute pt-0.5 ${this.isOpen ? 'block' : 'hidden'}`}\n        >\n          <slot></slot>\n        </div>\n      </div>\n    );\n  }\n\n  public render() {\n    if (this.searchStatus.state.hasError) {\n      return <Hidden></Hidden>;\n    }\n\n    if (!this.searchStatus.state.firstSearchExecuted) {\n      return (\n        <div\n          part=\"placeholder\"\n          aria-hidden\n          class=\"bg-neutral h-8 w-32 animate-pulse rounded\"\n        ></div>\n      );\n    }\n\n    if (!this.searchStatus.state.hasResults || !this.childFacet?.hasValues()) {\n      return <Hidden></Hidden>;\n    }\n\n    return (\n      <Host>\n        <atomic-focus-trap\n          source={this.buttonRef}\n          container={this.popupRef}\n          active={this.isOpen}\n          shouldHideSelf={false}\n        >\n          {this.renderPopover()}\n        </atomic-focus-trap>\n        {this.isOpen && this.renderBackdrop()}\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}