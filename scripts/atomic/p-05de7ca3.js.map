{"version":3,"names":["getWindow","window","getInitQueueNamespace","initQueueNamespace","eventQueueMap","Map","parentReadyMap","getEventQueueMap","getParentReadyMap","markParentAsReady","parent","set","eventQueue","get","reverse","length","event","element","pop","dispatchEvent","CustomEvent","bubbles","delete","isParentReady","queueEventForParent","has","push","enqueueOrDispatchInitializationEvent"],"sources":["src/utils/init-queue.ts"],"sourcesContent":["import {InitializeEventHandler} from './initialization-lit-stencil-common-utils';\n\nexport type InitializeEvent = CustomEvent<InitializeEventHandler>;\n\ndeclare global {\n  interface Window {\n    initQueueNamespace: {\n      eventQueueMap: Map<Element, QueuedEvent[]>;\n      parentReadyMap: Map<Element, boolean>;\n    };\n  }\n}\n\ntype QueuedEvent = {\n  event: InitializeEvent;\n  element: Element;\n};\n\nfunction getWindow() {\n  return window;\n}\n\nfunction getInitQueueNamespace() {\n  if (!getWindow().initQueueNamespace) {\n    getWindow().initQueueNamespace = {\n      eventQueueMap: new Map(),\n      parentReadyMap: new Map(),\n    };\n  }\n  return getWindow().initQueueNamespace;\n}\n\nfunction getEventQueueMap(): Map<Element, QueuedEvent[]> {\n  return getInitQueueNamespace().eventQueueMap;\n}\n\nfunction getParentReadyMap(): Map<Element, boolean> {\n  return getInitQueueNamespace().parentReadyMap;\n}\n\nexport function markParentAsReady(parent: Element) {\n  const parentReadyMap = getParentReadyMap();\n  parentReadyMap.set(parent, true);\n  const eventQueueMap = getEventQueueMap();\n  const eventQueue = eventQueueMap.get(parent) || [];\n  eventQueue.reverse();\n  while (eventQueue.length > 0) {\n    const {event, element} = eventQueue.pop()!;\n    element.dispatchEvent(event);\n  }\n  parent.dispatchEvent(new CustomEvent('atomic/parentReady', {bubbles: true}));\n  eventQueueMap.delete(parent);\n}\n\nexport function isParentReady(parent: Element): boolean {\n  const parentReadyMap = getParentReadyMap();\n  return parentReadyMap.get(parent) || false;\n}\n\nexport function queueEventForParent(\n  parent: Element,\n  event: InitializeEvent,\n  element: Element\n) {\n  const eventQueueMap = getEventQueueMap();\n  if (!eventQueueMap.has(parent)) {\n    eventQueueMap.set(parent, []);\n  }\n  eventQueueMap.get(parent)!.push({event, element});\n}\n\nexport function enqueueOrDispatchInitializationEvent(\n  parent: Element,\n  event: InitializeEvent,\n  element: Element\n) {\n  if (isParentReady(parent)) {\n    element.dispatchEvent(event);\n  } else {\n    queueEventForParent(parent, event, element);\n  }\n}\n"],"mappings":"AAkBA,SAASA,IACP,OAAOC,MACT,CAEA,SAASC,IACP,IAAKF,IAAYG,mBAAoB,CACnCH,IAAYG,mBAAqB,CAC/BC,cAAe,IAAIC,IACnBC,eAAgB,IAAID,I,CAGxB,OAAOL,IAAYG,kBACrB,CAEA,SAASI,IACP,OAAOL,IAAwBE,aACjC,CAEA,SAASI,IACP,OAAON,IAAwBI,cACjC,C,SAEgBG,EAAkBC,GAChC,MAAMJ,EAAiBE,IACvBF,EAAeK,IAAID,EAAQ,MAC3B,MAAMN,EAAgBG,IACtB,MAAMK,EAAaR,EAAcS,IAAIH,IAAW,GAChDE,EAAWE,UACX,MAAOF,EAAWG,OAAS,EAAG,CAC5B,MAAMC,MAACA,EAAKC,QAAEA,GAAWL,EAAWM,MACpCD,EAAQE,cAAcH,E,CAExBN,EAAOS,cAAc,IAAIC,YAAY,qBAAsB,CAACC,QAAS,QACrEjB,EAAckB,OAAOZ,EACvB,C,SAEgBa,EAAcb,GAC5B,MAAMJ,EAAiBE,IACvB,OAAOF,EAAeO,IAAIH,IAAW,KACvC,C,SAEgBc,EACdd,EACAM,EACAC,GAEA,MAAMb,EAAgBG,IACtB,IAAKH,EAAcqB,IAAIf,GAAS,CAC9BN,EAAcO,IAAID,EAAQ,G,CAE5BN,EAAcS,IAAIH,GAASgB,KAAK,CAACV,QAAOC,WAC1C,C,SAEgBU,EACdjB,EACAM,EACAC,GAEA,GAAIM,EAAcb,GAAS,CACzBO,EAAQE,cAAcH,E,KACjB,CACLQ,EAAoBd,EAAQM,EAAOC,E,CAEvC,Q","ignoreList":[]}