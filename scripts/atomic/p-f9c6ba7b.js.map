{"version":3,"names":["resultComponentClass","ItemListCommon","constructor","props","this","store","setLoadingFlag","loadingFlag","state","resultList","updateBreakpointsOnce","once","updateBreakpoints","host","getResultId","uniqueIdOnResult","searchResponseId","density","imageSize","setNewResultRef","element","resultIndex","firstResultEl","indexOfResultToFocus","children","length","shadowRoot","undefined","elementToFocus","getFirstFocusableDescendant","nextNewItemTarget","setTarget","focusOnNextNewResult","getCurrentNumberOfItems","focusOnNextTarget","focusOnFirstResultAfterNextSearch","defer","Promise","resolve","getIsLoading","unsub","engineSubscribe","async","focus"],"sources":["src/components/common/item-list/stencil-item-list-common.tsx"],"sourcesContent":["import {updateBreakpoints} from '../../../utils/replace-breakpoint';\nimport {\n  FocusTargetController,\n  getFirstFocusableDescendant,\n} from '../../../utils/stencil-accessibility-utils';\nimport {defer, once} from '../../../utils/utils';\nimport {CommerceStore} from '../../commerce/atomic-commerce-interface/store';\nimport {CommerceRecommendationStore} from '../../commerce/atomic-commerce-recommendation-interface/store';\nimport {InsightStore} from '../../insight/atomic-insight-interface/store';\nimport {RecsStore} from '../../recommendations/atomic-recs-interface/store';\nimport {SearchStore} from '../../search/atomic-search-interface/store';\nimport {AnyItem} from '../interface/item';\nimport {\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n} from '../layout/display-options';\n\nexport const resultComponentClass = 'result-component';\n\nexport type ItemRenderingFunction<SpecificResult extends AnyItem = AnyItem> =\n  | ((\n      result: SpecificResult,\n      root: HTMLElement,\n      linkContainer?: HTMLElement\n    ) => string)\n  | undefined;\n\nexport interface ItemListCommonProps {\n  store:\n    | CommerceStore\n    | CommerceRecommendationStore\n    | RecsStore\n    | InsightStore\n    | SearchStore;\n  loadingFlag: string;\n  host: HTMLElement;\n  nextNewItemTarget: FocusTargetController;\n  getCurrentNumberOfItems: () => number;\n  getIsLoading: () => boolean;\n  engineSubscribe: (cb: () => void) => () => void;\n}\n\nexport class ItemListCommon {\n  private indexOfResultToFocus?: number;\n  private firstResultEl?: HTMLElement;\n  private updateBreakpointsOnce: () => void;\n\n  constructor(private props: ItemListCommonProps) {\n    this.props.store.setLoadingFlag(this.props.loadingFlag);\n    this.props.store.state.resultList = this;\n    this.updateBreakpointsOnce = once(() => updateBreakpoints(this.props.host));\n  }\n\n  public updateBreakpoints() {\n    this.updateBreakpointsOnce();\n  }\n\n  public getResultId(\n    uniqueIdOnResult: string,\n    searchResponseId: string,\n    density: ItemDisplayDensity,\n    imageSize: ItemDisplayImageSize\n  ) {\n    return `${uniqueIdOnResult}${searchResponseId}${density}${imageSize}`;\n  }\n\n  public setNewResultRef(element: HTMLElement, resultIndex: number) {\n    if (resultIndex === 0) {\n      this.firstResultEl = element;\n    }\n    if (resultIndex !== this.indexOfResultToFocus) {\n      return;\n    }\n\n    if (!element.children.length && !element.shadowRoot?.children.length) {\n      return;\n    }\n\n    this.indexOfResultToFocus = undefined;\n    const elementToFocus = getFirstFocusableDescendant(element) ?? element;\n    this.props.nextNewItemTarget.setTarget(elementToFocus);\n  }\n\n  public focusOnNextNewResult() {\n    this.indexOfResultToFocus = this.props.getCurrentNumberOfItems();\n    this.props.nextNewItemTarget.focusOnNextTarget();\n  }\n\n  public async focusOnFirstResultAfterNextSearch() {\n    await defer();\n    return new Promise<void>((resolve) => {\n      if (this.props.getIsLoading()) {\n        this.firstResultEl = undefined;\n      }\n\n      const unsub = this.props.engineSubscribe(async () => {\n        await defer();\n        if (!this.props.getIsLoading() && this.firstResultEl) {\n          const elementToFocus =\n            getFirstFocusableDescendant(this.firstResultEl) ??\n            this.firstResultEl;\n          this.props.nextNewItemTarget.setTarget(elementToFocus);\n          this.props.nextNewItemTarget.focus();\n          this.firstResultEl = undefined;\n          unsub();\n          resolve();\n        }\n      });\n    });\n  }\n}\n"],"mappings":"yHAiBaA,EAAuB,mB,MAyBvBC,EAKX,WAAAC,CAAoBC,GAAAC,KAAAD,QAClBC,KAAKD,MAAME,MAAMC,eAAeF,KAAKD,MAAMI,aAC3CH,KAAKD,MAAME,MAAMG,MAAMC,WAAaL,KACpCA,KAAKM,sBAAwBC,GAAK,IAAMC,EAAkBR,KAAKD,MAAMU,O,CAGhE,iBAAAD,GACLR,KAAKM,uB,CAGA,WAAAI,CACLC,EACAC,EACAC,EACAC,GAEA,MAAO,GAAGH,IAAmBC,IAAmBC,IAAUC,G,CAGrD,eAAAC,CAAgBC,EAAsBC,GAC3C,GAAIA,IAAgB,EAAG,CACrBjB,KAAKkB,cAAgBF,C,CAEvB,GAAIC,IAAgBjB,KAAKmB,qBAAsB,CAC7C,M,CAGF,IAAKH,EAAQI,SAASC,SAAWL,EAAQM,YAAYF,SAASC,OAAQ,CACpE,M,CAGFrB,KAAKmB,qBAAuBI,UAC5B,MAAMC,EAAiBC,EAA4BT,IAAYA,EAC/DhB,KAAKD,MAAM2B,kBAAkBC,UAAUH,E,CAGlC,oBAAAI,GACL5B,KAAKmB,qBAAuBnB,KAAKD,MAAM8B,0BACvC7B,KAAKD,MAAM2B,kBAAkBI,mB,CAGxB,uCAAMC,SACLC,IACN,OAAO,IAAIC,SAAeC,IACxB,GAAIlC,KAAKD,MAAMoC,eAAgB,CAC7BnC,KAAKkB,cAAgBK,S,CAGvB,MAAMa,EAAQpC,KAAKD,MAAMsC,iBAAgBC,gBACjCN,IACN,IAAKhC,KAAKD,MAAMoC,gBAAkBnC,KAAKkB,cAAe,CACpD,MAAMM,EACJC,EAA4BzB,KAAKkB,gBACjClB,KAAKkB,cACPlB,KAAKD,MAAM2B,kBAAkBC,UAAUH,GACvCxB,KAAKD,MAAM2B,kBAAkBa,QAC7BvC,KAAKkB,cAAgBK,UACrBa,IACAF,G,IAEF,G","ignoreList":[]}