{"version":3,"names":["atomicCategoryFacetCss","AtomicCategoryFacetStyle0","AtomicCategoryFacet","this","resultIndexToFocusOnShowMore","label","tabsIncluded","tabsExcluded","numberOfValues","withSearch","sortCriteria","delimitingCharacter","basePath","filterByBasePath","isCollapsed","headingLevel","filterFacetCount","injectionDepth","dependsOn","initialize","length","console","warn","searchStatus","buildSearchStatus","bindings","engine","tabManager","buildTabManager","options","facetId","field","facetSearch","tabs","included","excluded","facet","buildCategoryFacet","announceFacetSearchResultsWithAriaLive","msg","facetSearchAriaMessage","i18n","state","facetInfo","t","element","host","isHidden","store","registerFacet","initializePopover","hasValues","valuesAsTrees","numberOfActiveValues","facetState","hasActiveValues","initializeDependenciesManager","focusTargets","showLessFocus","FocusTargetController","showMoreFocus","headerFocus","activeValueFocus","disconnectedCallback","isConnected","dependenciesManager","stopWatching","searchStatusState","hasError","enabled","selectedValueAncestry","componentShouldUpdate","next","prev","propName","isCategoryFacetState","shouldUpdateFacetSearchComponent","hasParents","buildFacetConditionsManager","conditions","parseDependsOn","renderHeader","h","FacetHeader","onToggleCollapse","onClearFilters","focusAfterSearch","deselectAll","headerRef","header","setTarget","renderSearchInput","FacetSearchInput","query","onChange","value","clear","updateCaptions","getFieldCaptions","updateText","search","onClear","renderValuesTree","isRoot","renderChildren","CategoryFacetTreeValueContainer","CategoryFacetAllCategoryButton","onClick","CategoryFacetParentAsTreeContainer","isTopLevel","parentValue","CategoryFacetParentButton","facetValue","toggleSelect","slice","activeParent","activeParentDisplayValue","getFieldValueCaption","CategoryFacetParentValueLink","displayValue","numberOfResults","isLeafValue","searchQuery","setRef","el","CategoryFacetChildrenAsTreeContainer","renderChild","isShowLessFocusTarget","isShowMoreFocusTarget","isSelected","CategoryFacetChildValueLink","find","children","map","i","renderSearchResults","CategoryFacetSearchResultsContainer","values","CategoryFacetSearchValue","select","renderMatches","FacetSearchMatches","numberOfMatches","hasMoreMatches","moreValuesAvailable","showMoreMatches","showMoreResults","renderShowMoreLess","class","FacetShowMoreLess","onShowMore","showMoreValues","onShowLess","showLessValues","canShowLessValues","canShowMoreValues","render","firstSearchExecuted","FacetGuard","key","hasResults","FacetContainer","shouldDisplaySearchResults","Fragment","FacetValuesGroup","className","FacetPlaceholder","__decorate","InitializeBindings","BindStateToController","ArrayProp","MapProp","AriaLiveRegion"],"sources":["src/components/search/facets/atomic-category-facet/atomic-category-facet.pcss?tag=atomic-category-facet&encapsulation=shadow","src/components/search/facets/atomic-category-facet/atomic-category-facet.tsx"],"sourcesContent":["@import '../../../common/facets/facet-common.pcss';\n@import '../../../common/facets/facet-search/facet-search.pcss';\n\n[part~='active-parent'] {\n  @apply pl-9;\n}\n\n[part~='parents'] [part~='values'] {\n  @apply pl-9;\n}\n\n[part~='all-categories-button'],\n[part~='parent-button'] {\n  @apply relative flex w-full items-center py-2.5 pr-2 pl-7 text-left;\n}\n\n[part~='back-arrow'] {\n  @apply absolute left-1 h-5 w-5;\n}\n","import {\n  CategoryFacet,\n  buildCategoryFacet,\n  CategoryFacetState,\n  CategoryFacetOptions,\n  CategoryFacetSortCriterion,\n  SearchStatus,\n  SearchStatusState,\n  buildSearchStatus,\n  CategoryFacetValue,\n  buildFacetConditionsManager,\n  FacetConditionsManager,\n  FacetValueRequest,\n  CategoryFacetValueRequest,\n  TabManagerState,\n  TabManager,\n  buildTabManager,\n} from '@coveo/headless';\nimport {Component, h, State, Prop, Element, Fragment} from '@stencil/core';\nimport {\n  getFieldCaptions,\n  getFieldValueCaption,\n} from '../../../../utils/field-utils';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {ArrayProp, MapProp} from '../../../../utils/props-utils';\nimport {\n  AriaLiveRegion,\n  FocusTargetController,\n} from '../../../../utils/stencil-accessibility-utils';\nimport {CategoryFacetAllCategoryButton} from '../../../common/facets/category-facet/all-categories-button';\nimport {CategoryFacetChildValueLink} from '../../../common/facets/category-facet/child-value-link';\nimport {CategoryFacetChildrenAsTreeContainer} from '../../../common/facets/category-facet/children-as-tree-container';\nimport {CategoryFacetParentAsTreeContainer} from '../../../common/facets/category-facet/parent-as-tree-container';\nimport {CategoryFacetParentButton} from '../../../common/facets/category-facet/parent-button';\nimport {CategoryFacetParentValueLink} from '../../../common/facets/category-facet/parent-value-link';\nimport {CategoryFacetSearchResultsContainer} from '../../../common/facets/category-facet/search-results-container';\nimport {CategoryFacetSearchValue} from '../../../common/facets/category-facet/search-value';\nimport {CategoryFacetTreeValueContainer} from '../../../common/facets/category-facet/value-as-tree-container';\nimport {parseDependsOn} from '../../../common/facets/depends-on';\nimport {FacetInfo} from '../../../common/facets/facet-common-store';\nimport {FacetContainer} from '../../../common/facets/facet-container/stencil-facet-container';\nimport {FacetGuard} from '../../../common/facets/facet-guard';\nimport {FacetHeader} from '../../../common/facets/facet-header/stencil-facet-header';\nimport {FacetPlaceholder} from '../../../common/facets/facet-placeholder/facet-placeholder';\nimport {announceFacetSearchResultsWithAriaLive} from '../../../common/facets/facet-search/facet-search-aria-live';\nimport {\n  shouldUpdateFacetSearchComponent,\n  shouldDisplaySearchResults,\n} from '../../../common/facets/facet-search/facet-search-utils';\nimport {FacetSearchInput} from '../../../common/facets/facet-search/stencil-facet-search-input';\nimport {FacetSearchMatches} from '../../../common/facets/facet-search/stencil-facet-search-matches';\nimport {FacetShowMoreLess} from '../../../common/facets/facet-show-more-less/stencil-facet-show-more-less';\nimport {FacetValuesGroup} from '../../../common/facets/facet-values-group/stencil-facet-values-group';\nimport {initializePopover} from '../../../common/facets/popover/popover-type';\nimport {Bindings} from '../../atomic-search-interface/atomic-search-interface';\n\n/**\n * A facet is a list of values for a certain field occurring in the results, ordered using a configurable criteria (e.g., number of occurrences).\n * An `atomic-category-facet` displays a facet of values in a browsable, hierarchical fashion.\n *\n * @part facet - The wrapper for the entire facet.\n * @part placeholder - The placeholder shown before the first search is executed.\n *\n * @part label-button - The button that displays the label and allows to expand/collapse the facet.\n * @part label-button-icon - The label button icon.\n *\n * @part search-wrapper - The search box wrapper.\n * @part search-input - The search box input.\n * @part search-icon - The search box submit button.\n * @part search-clear-button - The button to clear the search box of input.\n * @part more-matches - The label indicating there are more matches for the current facet search query.\n * @part no-matches - The label indicating there are no matches for the current facet search query.\n * @part matches-query - The highlighted query inside the matches labels.\n * @part search-results - The search results container.\n * @part search-result - The search result value.\n * @part search-result-path - The search result path.\n * @part search-highlight - The highlighted query inside the facet values.\n *\n * @part parents - The container surrounding the whole hierarchy of values.\n * @part sub-parents - The container surrounding a sub-hierarchy of values.\n * @part values - The container surrounding either the children of the active value or the values at the base.\n * @part all-categories-button - The \"View all\" button displayed first within the parents.\n * @part parent-button - The clickable parent button displayed first within sub-parents.\n * @part active-parent - The clickable active parent displayed first within the last sub-parents.\n * @part value-link - The clickable value displayed first within values.\n * @part back-arrow - The back arrow displayed before the clickable parents.\n * @part value-label - The facet value label within a value button.\n * @part value-count - The facet value count within a value button.\n * @part leaf-value - A facet value with no child value.\n * @part node-value - A facet value with child values.\n *\n * @part show-more - The show more results button.\n * @part show-less - The show less results button.\n * @part show-more-less-icon - The icons of the show more & show less buttons.\n */\n@Component({\n  tag: 'atomic-category-facet',\n  styleUrl: 'atomic-category-facet.pcss',\n  shadow: true,\n})\nexport class AtomicCategoryFacet implements InitializableComponent {\n  @InitializeBindings() public bindings!: Bindings;\n  public facet!: CategoryFacet;\n  private dependenciesManager?: FacetConditionsManager;\n  private resultIndexToFocusOnShowMore = 0;\n  public searchStatus!: SearchStatus;\n  public tabManager!: TabManager;\n  @Element() private host!: HTMLElement;\n\n  @BindStateToController('facet')\n  @State()\n  public facetState!: CategoryFacetState;\n  @BindStateToController('searchStatus')\n  @State()\n  public searchStatusState!: SearchStatusState;\n  @BindStateToController('tabManager')\n  @State()\n  public tabManagerState!: TabManagerState;\n  @State() public error!: Error;\n\n  /**\n   * Specifies a unique identifier for the facet.\n   */\n  @Prop({mutable: true, reflect: true}) public facetId?: string;\n  /**\n   * The non-localized label for the facet.\n   * Used in the `atomic-breadbox` component through the bindings store.\n   */\n  @Prop({reflect: true}) public label = 'no-label';\n  /**\n   * The field whose values you want to display in the facet.\n   */\n  @Prop({reflect: true}) public field!: string;\n  /**\n   * The tabs on which the facet can be displayed. This property should not be used at the same time as `tabs-excluded`.\n   *\n   * Set this property as a stringified JSON array, e.g.,\n   * ```html\n   *  <atomic-timeframe-facet tabs-included='[\"tabIDA\", \"tabIDB\"]'></atomic-timeframe-facet>\n   * ```\n   * If you don't set this property, the facet can be displayed on any tab. Otherwise, the facet can only be displayed on the specified tabs.\n   */\n  @ArrayProp()\n  @Prop({reflect: true, mutable: true})\n  public tabsIncluded: string[] | string = '[]';\n\n  /**\n   * The tabs on which this facet must not be displayed. This property should not be used at the same time as `tabs-included`.\n   *\n   * Set this property as a stringified JSON array, e.g.,\n   * ```html\n   *  <atomic-timeframe-facet tabs-excluded='[\"tabIDA\", \"tabIDB\"]'></atomic-timeframe-facet>\n   * ```\n   * If you don't set this property, the facet can be displayed on any tab. Otherwise, the facet won't be displayed on any of the specified tabs.\n   */\n  @ArrayProp()\n  @Prop({reflect: true, mutable: true})\n  public tabsExcluded: string[] | string = '[]';\n\n  /**\n   * The number of values to request for this facet.\n   * Also determines the number of additional values to request each time more values are shown.\n   */\n  @Prop({reflect: true}) public numberOfValues = 8;\n  /**\n   * Whether this facet should contain a search box.\n   *\n   */\n  @Prop({reflect: true}) public withSearch = false;\n  /**\n   * The sort criterion to apply to the returned facet values.\n   * Possible values are 'alphanumeric' and 'occurrences'.\n   * For this criterion to apply to the top-layer facet values, disable\n   * [facet value ordering](https://docs.coveo.com/en/l1qf4156/#facet-value-ordering)\n   * in your Dynamic Navigation Experience configuration.\n   */\n  // TODO: add automatic (occurrences when not expanded, alphanumeric when expanded)\n  @Prop({reflect: true}) public sortCriteria: CategoryFacetSortCriterion =\n    'occurrences';\n  /**\n   * The character that separates values of a multi-value field.\n   *\n   * *Note:* If you use the [example formatting](https://docs.coveo.com/en/atomic/latest/reference/components/atomic-category-facet/#usage-notes) for the associated multi-value field, you must set this value to `|` or the facet won't display properly.\n   */\n  @Prop({reflect: true}) public delimitingCharacter = ';';\n  /**\n   * The base path shared by all values for the facet.\n   *\n   * Specify the property as an array using a JSON string representation:\n   * ```html\n   *  <atomic-category-facet base-path='[\"first value\", \"second value\"]' ></atomic-category-facet>\n   * ```\n   */\n  @ArrayProp()\n  @Prop({reflect: true, mutable: true})\n  public basePath: string[] | string = '[]';\n\n  /**\n   * Whether to use basePath as a filter for the results.\n   */\n  @Prop({reflect: true}) public filterByBasePath = true;\n  /**\n   * Specifies whether the facet is collapsed. When the facet is the child of an `atomic-facet-manager` component, the facet manager controls this property.\n   */\n  @Prop({reflect: true, mutable: true}) public isCollapsed = false;\n  /**\n   * The [heading level](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements) to use for the heading over the facet, from 1 to 6.\n   */\n  @Prop({reflect: true}) public headingLevel = 0;\n  /**\n   * Whether to exclude the parents of folded results when estimating the result count for each facet value.\n   *\n   *\n   * Note: Resulting count is only an estimation, in some cases this value could be incorrect.\n   */\n  @Prop({reflect: true}) public filterFacetCount = true;\n  /**\n   * The maximum number of results to scan in the index to ensure that the facet lists all potential facet values.\n   * Note: A high injectionDepth may negatively impact the facet request performance.\n   * Minimum: `0`\n   * Default: `1000`\n   */\n  @Prop({reflect: true}) public injectionDepth = 1000;\n  // @Prop() public customSort?: string; TODO: KIT-753 Add customSort option for facet\n\n  /**\n   * The required facets and values for this facet to be displayed.\n   * Examples:\n   * ```html\n   * <atomic-facet facet-id=\"abc\" field=\"objecttype\" ...></atomic-facet>\n   *\n   * <!-- To show the facet when any value is selected in the facet with id \"abc\": -->\n   * <atomic-category-facet\n   *   depends-on-abc\n   *   ...\n   * ></atomic-category-facet>\n   *\n   * <!-- To show the facet when value \"doc\" is selected in the facet with id \"abc\": -->\n   * <atomic-category-facet\n   *   depends-on-abc=\"doc\"\n   *   ...\n   * ></atomic-category-facet>\n   * ```\n   */\n  @MapProp() @Prop() public dependsOn: Record<string, string> = {};\n\n  private showLessFocus?: FocusTargetController;\n\n  private showMoreFocus?: FocusTargetController;\n\n  private headerFocus?: FocusTargetController;\n\n  private activeValueFocus?: FocusTargetController;\n\n  @AriaLiveRegion('facet-search')\n  protected facetSearchAriaMessage!: string;\n\n  public initialize() {\n    if (\n      [...this.tabsIncluded].length > 0 &&\n      [...this.tabsExcluded].length > 0\n    ) {\n      console.warn(\n        'Values for both \"tabs-included\" and \"tabs-excluded\" have been provided. This is could lead to unexpected behaviors.'\n      );\n    }\n    this.searchStatus = buildSearchStatus(this.bindings.engine);\n    this.tabManager = buildTabManager(this.bindings.engine);\n    const options: CategoryFacetOptions = {\n      facetId: this.facetId,\n      field: this.field,\n      numberOfValues: this.numberOfValues,\n      sortCriteria: this.sortCriteria,\n      facetSearch: {numberOfValues: this.numberOfValues},\n      basePath: [...this.basePath],\n      delimitingCharacter: this.delimitingCharacter,\n      filterByBasePath: this.filterByBasePath,\n      injectionDepth: this.injectionDepth,\n      filterFacetCount: this.filterFacetCount,\n      tabs: {\n        included: [...this.tabsIncluded],\n        excluded: [...this.tabsExcluded],\n      },\n    };\n    this.facet = buildCategoryFacet(this.bindings.engine, {options});\n    announceFacetSearchResultsWithAriaLive(\n      this.facet,\n      this.label,\n      (msg) => (this.facetSearchAriaMessage = msg),\n      this.bindings.i18n\n    );\n    this.facetId = this.facet.state.facetId;\n    const facetInfo: FacetInfo = {\n      label: () => this.bindings.i18n.t(this.label),\n      facetId: this.facetId!,\n      element: this.host,\n      isHidden: () => this.isHidden,\n    };\n    this.bindings.store.registerFacet('categoryFacets', facetInfo);\n    initializePopover(this.host, {\n      ...facetInfo,\n      hasValues: () => !!this.facet.state.valuesAsTrees.length,\n      numberOfActiveValues: () => (this.facetState.hasActiveValues ? 1 : 0),\n    });\n    this.initializeDependenciesManager();\n  }\n\n  private get focusTargets() {\n    if (!this.showLessFocus) {\n      this.showLessFocus = new FocusTargetController(this);\n    }\n    if (!this.showMoreFocus) {\n      this.showMoreFocus = new FocusTargetController(this);\n    }\n    if (!this.headerFocus) {\n      this.headerFocus = new FocusTargetController(this);\n    }\n    if (!this.activeValueFocus) {\n      this.activeValueFocus = new FocusTargetController(this);\n    }\n\n    return {\n      showLessFocus: this.showLessFocus,\n      showMoreFocus: this.showMoreFocus,\n      headerFocus: this.headerFocus,\n      activeValueFocus: this.activeValueFocus,\n    };\n  }\n\n  public disconnectedCallback() {\n    if (this.host.isConnected) {\n      return;\n    }\n    this.dependenciesManager?.stopWatching();\n  }\n\n  private get isHidden() {\n    return (\n      this.searchStatusState.hasError ||\n      !this.facet.state.enabled ||\n      (!this.facet.state.selectedValueAncestry.length &&\n        !this.facet.state.valuesAsTrees.length)\n    );\n  }\n\n  public componentShouldUpdate(\n    next: unknown,\n    prev: unknown,\n    propName: keyof AtomicCategoryFacet\n  ) {\n    if (\n      this.isCategoryFacetState(prev, propName) &&\n      this.isCategoryFacetState(next, propName)\n    ) {\n      return shouldUpdateFacetSearchComponent(\n        next.facetSearch,\n        prev.facetSearch\n      );\n    }\n    return true;\n  }\n\n  private get hasParents() {\n    return !!this.facetState.selectedValueAncestry.length;\n  }\n\n  private initializeDependenciesManager() {\n    this.dependenciesManager = buildFacetConditionsManager(\n      this.bindings.engine,\n      {\n        facetId: this.facetId!,\n        conditions: parseDependsOn<\n          FacetValueRequest | CategoryFacetValueRequest\n        >(this.dependsOn),\n      }\n    );\n  }\n\n  private renderHeader() {\n    return (\n      <FacetHeader\n        i18n={this.bindings.i18n}\n        label={this.label}\n        numberOfActiveValues={\n          this.facetState.hasActiveValues && this.isCollapsed ? 1 : 0\n        }\n        isCollapsed={this.isCollapsed}\n        headingLevel={this.headingLevel}\n        onToggleCollapse={() => (this.isCollapsed = !this.isCollapsed)}\n        onClearFilters={() => {\n          this.focusTargets.headerFocus.focusAfterSearch();\n          this.facet.deselectAll();\n        }}\n        headerRef={(header) => {\n          this.focusTargets.headerFocus.setTarget(header);\n          if (!this.hasParents) {\n            this.focusTargets.activeValueFocus.setTarget(header);\n          }\n        }}\n      ></FacetHeader>\n    );\n  }\n\n  private renderSearchInput() {\n    if (!this.withSearch) {\n      return;\n    }\n\n    return (\n      <FacetSearchInput\n        i18n={this.bindings.i18n}\n        label={this.label}\n        query={this.facetState.facetSearch.query}\n        onChange={(value) => {\n          if (value === '') {\n            this.facet.facetSearch.clear();\n            return;\n          }\n          this.facet.facetSearch.updateCaptions(\n            getFieldCaptions(this.field, this.bindings.i18n)\n          );\n          this.facet.facetSearch.updateText(value);\n          this.facet.facetSearch.search();\n        }}\n        onClear={() => this.facet.facetSearch.clear()}\n      ></FacetSearchInput>\n    );\n  }\n\n  private renderValuesTree(\n    valuesAsTrees: CategoryFacetValue[],\n    isRoot: boolean\n  ) {\n    if (!this.hasParents) {\n      return this.renderChildren();\n    }\n\n    if (isRoot) {\n      return (\n        <CategoryFacetTreeValueContainer>\n          <CategoryFacetAllCategoryButton\n            i18n={this.bindings.i18n}\n            onClick={() => {\n              this.focusTargets.activeValueFocus.focusAfterSearch();\n              this.facet.deselectAll();\n            }}\n          />\n          <CategoryFacetParentAsTreeContainer isTopLevel={false}>\n            {this.renderValuesTree(valuesAsTrees, false)}\n          </CategoryFacetParentAsTreeContainer>\n        </CategoryFacetTreeValueContainer>\n      );\n    }\n\n    if (valuesAsTrees.length > 1) {\n      const parentValue = valuesAsTrees[0];\n\n      return (\n        <CategoryFacetTreeValueContainer>\n          <CategoryFacetParentButton\n            facetValue={parentValue}\n            field={this.field}\n            i18n={this.bindings.i18n}\n            onClick={() => {\n              this.focusTargets.activeValueFocus.focusAfterSearch();\n              this.facet.toggleSelect(parentValue);\n            }}\n          />\n          <CategoryFacetParentAsTreeContainer isTopLevel={false}>\n            {this.renderValuesTree(valuesAsTrees.slice(1), false)}\n          </CategoryFacetParentAsTreeContainer>\n        </CategoryFacetTreeValueContainer>\n      );\n    }\n\n    const activeParent = valuesAsTrees[0];\n    const activeParentDisplayValue = getFieldValueCaption(\n      this.field,\n      activeParent.value,\n      this.bindings.i18n\n    );\n\n    return (\n      <CategoryFacetParentValueLink\n        displayValue={activeParentDisplayValue}\n        numberOfResults={activeParent.numberOfResults}\n        i18n={this.bindings.i18n}\n        isLeafValue={activeParent.isLeafValue}\n        onClick={() => {\n          this.focusTargets.activeValueFocus.focusAfterSearch();\n          this.facet.deselectAll();\n        }}\n        searchQuery={this.facetState.facetSearch.query}\n        setRef={(el) => this.focusTargets.activeValueFocus.setTarget(el)}\n      >\n        <CategoryFacetChildrenAsTreeContainer>\n          {this.renderChildren()}\n        </CategoryFacetChildrenAsTreeContainer>\n      </CategoryFacetParentValueLink>\n    );\n  }\n\n  private renderChild(\n    facetValue: CategoryFacetValue,\n    isShowLessFocusTarget: boolean,\n    isShowMoreFocusTarget: boolean\n  ) {\n    const displayValue = getFieldValueCaption(\n      this.field,\n      facetValue.value,\n      this.bindings.i18n\n    );\n    const isSelected = facetValue.state === 'selected';\n    return (\n      <CategoryFacetChildValueLink\n        displayValue={displayValue}\n        i18n={this.bindings.i18n}\n        isLeafValue={facetValue.isLeafValue}\n        isSelected={isSelected}\n        numberOfResults={facetValue.numberOfResults}\n        onClick={() => {\n          this.focusTargets.activeValueFocus.focusAfterSearch();\n          this.facet.toggleSelect(facetValue);\n        }}\n        searchQuery={this.facetState.facetSearch.query}\n        setRef={(element) => {\n          isShowLessFocusTarget &&\n            this.focusTargets.showLessFocus.setTarget(element);\n          isShowMoreFocusTarget &&\n            this.focusTargets.showMoreFocus.setTarget(element);\n        }}\n      ></CategoryFacetChildValueLink>\n    );\n  }\n\n  private renderChildren() {\n    if (!this.facetState.valuesAsTrees.length) {\n      return;\n    }\n    if (this.facetState.selectedValueAncestry.length > 0) {\n      return this.facetState.selectedValueAncestry\n        .find((value) => value.state === 'selected')\n        ?.children.map((value, i) =>\n          this.renderChild(\n            value,\n            i === 0,\n            i === this.resultIndexToFocusOnShowMore\n          )\n        );\n    }\n\n    return this.facetState.valuesAsTrees.map((value, i) =>\n      this.renderChild(value, i === 0, i === this.resultIndexToFocusOnShowMore)\n    );\n  }\n\n  private renderSearchResults() {\n    return (\n      <CategoryFacetSearchResultsContainer>\n        {this.facetState.facetSearch.values.map((value) => (\n          <CategoryFacetSearchValue\n            value={value}\n            field={this.field}\n            i18n={this.bindings.i18n}\n            searchQuery={this.facetState.facetSearch.query}\n            onClick={() => {\n              this.focusTargets.activeValueFocus.focusAfterSearch();\n              this.facet.facetSearch.select(value);\n            }}\n          ></CategoryFacetSearchValue>\n        ))}\n      </CategoryFacetSearchResultsContainer>\n    );\n  }\n\n  private renderMatches() {\n    return (\n      <FacetSearchMatches\n        i18n={this.bindings.i18n}\n        query={this.facetState.facetSearch.query}\n        numberOfMatches={this.facetState.facetSearch.values.length}\n        hasMoreMatches={this.facetState.facetSearch.moreValuesAvailable}\n        showMoreMatches={() => this.facet.facetSearch.showMoreResults()}\n      ></FacetSearchMatches>\n    );\n  }\n\n  private renderShowMoreLess() {\n    return (\n      <div class={this.hasParents ? 'pl-9' : ''}>\n        <FacetShowMoreLess\n          label={this.label}\n          i18n={this.bindings.i18n}\n          onShowMore={() => {\n            this.resultIndexToFocusOnShowMore =\n              this.facetState.valuesAsTrees[0].children.length;\n            this.focusTargets.showMoreFocus.focusAfterSearch();\n            this.facet.showMoreValues();\n          }}\n          onShowLess={() => {\n            this.focusTargets.showLessFocus.focusAfterSearch();\n            this.facet.showLessValues();\n          }}\n          canShowLessValues={this.facetState.canShowLessValues}\n          canShowMoreValues={this.facetState.canShowMoreValues}\n        ></FacetShowMoreLess>\n      </div>\n    );\n  }\n\n  private isCategoryFacetState(\n    state: unknown,\n    propName: string\n  ): state is CategoryFacetState {\n    return (\n      propName === 'facetState' &&\n      typeof (state as CategoryFacetState)?.facetId === 'string'\n    );\n  }\n\n  public render() {\n    const {\n      bindings: {i18n},\n      label,\n      facetState: {facetSearch, enabled, valuesAsTrees, selectedValueAncestry},\n      searchStatusState: {hasError, firstSearchExecuted},\n    } = this;\n\n    return (\n      <FacetGuard\n        enabled={enabled}\n        firstSearchExecuted={firstSearchExecuted}\n        hasError={hasError}\n        hasResults={valuesAsTrees.length > 0}\n      >\n        {firstSearchExecuted ? (\n          <FacetContainer>\n            {this.renderHeader()}\n            {!this.isCollapsed && [\n              this.renderSearchInput(),\n              shouldDisplaySearchResults(facetSearch) ? (\n                <Fragment>\n                  {facetSearch.values.length ? (\n                    <FacetValuesGroup\n                      i18n={i18n}\n                      label={label}\n                      query={facetSearch.query}\n                    >\n                      {this.renderSearchResults()}\n                    </FacetValuesGroup>\n                  ) : (\n                    <div class=\"mt-3\"></div>\n                  )}\n                  {this.renderMatches()}\n                </Fragment>\n              ) : (\n                <Fragment>\n                  <FacetValuesGroup i18n={i18n} label={label}>\n                    {this.hasParents ? (\n                      <CategoryFacetParentAsTreeContainer\n                        isTopLevel={true}\n                        className=\"mt-3\"\n                      >\n                        {this.renderValuesTree(selectedValueAncestry, true)}\n                      </CategoryFacetParentAsTreeContainer>\n                    ) : (\n                      <CategoryFacetChildrenAsTreeContainer className=\"mt-3\">\n                        {this.renderChildren()}\n                      </CategoryFacetChildrenAsTreeContainer>\n                    )}\n                  </FacetValuesGroup>\n                  {this.renderShowMoreLess()}\n                </Fragment>\n              ),\n            ]}\n          </FacetContainer>\n        ) : (\n          <FacetPlaceholder\n            isCollapsed={this.isCollapsed}\n            numberOfValues={this.numberOfValues}\n          />\n        )}\n      </FacetGuard>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}