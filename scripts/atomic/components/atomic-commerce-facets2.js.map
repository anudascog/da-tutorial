{"file":"atomic-commerce-facets2.js","mappings":"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","names":[],"sources":["src/components/commerce/facets/atomic-commerce-facets/atomic-commerce-facets.tsx"],"sourcesContent":["import {NumberValue, Schema} from '@coveo/bueno';\nimport {\n  RegularFacet,\n  CategoryFacet,\n  DateFacet,\n  NumericFacet,\n  FacetGeneratorState,\n  buildProductListing,\n  buildSearch,\n  FacetGenerator,\n  Summary,\n  SearchSummaryState,\n  ProductListingSummaryState,\n} from '@coveo/headless/commerce';\nimport {Component, h, Element, State, Prop, Fragment} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {FacetPlaceholder} from '../../../common/facets/facet-placeholder/facet-placeholder';\nimport {createAppLoadedListener} from '../../../common/interface/store';\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\n\n/**\n * The `atomic-commerce-facets` component automatically renders commerce facets based on the Commerce API response.\n * Unlike regular facets, which require explicit definition and request in the query, the `atomic-commerce-facets` component dynamically generates facets.\n *\n * @alpha\n */\n@Component({\n  tag: 'atomic-commerce-facets',\n  shadow: false,\n})\nexport class AtomicCommerceFacets implements InitializableComponent<Bindings> {\n  @InitializeBindings() public bindings!: Bindings;\n  public facetGenerator!: FacetGenerator;\n  public summary!: Summary<SearchSummaryState | ProductListingSummaryState>;\n  @Element() host!: HTMLElement;\n\n  /**\n   * The maximum number of facets to expand.\n   * Remaining facets are automatically collapsed.\n   *\n   * Using the value `0` collapses all facets.\n   * Using the value `-1` disables the feature and keeps all facets expanded.\n   */\n  @Prop({reflect: true}) public collapseFacetsAfter = 4;\n\n  @BindStateToController('facetGenerator')\n  @State()\n  public facetGeneratorState!: FacetGeneratorState;\n\n  @State() public error!: Error;\n  @State() private isAppLoaded = false;\n\n  public initialize() {\n    this.validateProps();\n    const {engine} = this.bindings;\n    const controller = this.controllerBuilder(engine);\n    this.facetGenerator = controller.facetGenerator();\n    this.summary = controller.summary();\n    createAppLoadedListener(this.bindings.store, (isAppLoaded) => {\n      this.isAppLoaded = isAppLoaded;\n    });\n  }\n\n  private isProductListing() {\n    return this.bindings.interfaceElement.type === 'product-listing';\n  }\n\n  private get controllerBuilder() {\n    return this.isProductListing() ? buildProductListing : buildSearch;\n  }\n\n  private validateProps() {\n    new Schema({\n      collapseFacetAfter: new NumberValue({min: -1, required: true}),\n    }).validate({\n      collapseFacetAfter: this.collapseFacetsAfter,\n    });\n  }\n\n  private shouldCollapseFacet(index: number): boolean {\n    if (this.collapseFacetsAfter === -1) {\n      return false;\n    }\n    return this.collapseFacetsAfter\n      ? index + 1 > this.collapseFacetsAfter\n      : true;\n  }\n\n  public render() {\n    if (!this.isAppLoaded) {\n      return [...Array.from({length: this.collapseFacetsAfter})].map(() => (\n        <FacetPlaceholder isCollapsed={false} numberOfValues={8} />\n      ));\n    }\n    return (\n      <Fragment>\n        {this.facetGenerator.facets.map((facet, index) => {\n          if (facet.state.values.length === 0) {\n            return;\n          }\n\n          const props = <T,>() => ({\n            isCollapsed: this.shouldCollapseFacet(index),\n            summary: this.summary,\n            facet: facet as T,\n            field: facet.state.field,\n            key: facet.state.facetId,\n          });\n\n          switch (facet.state.type) {\n            case 'regular':\n              return (\n                <atomic-commerce-facet\n                  {...props<RegularFacet>()}\n                ></atomic-commerce-facet>\n              );\n            case 'numericalRange':\n              return (\n                <atomic-commerce-numeric-facet\n                  {...props<NumericFacet>()}\n                ></atomic-commerce-numeric-facet>\n              );\n            case 'dateRange':\n              return (\n                <atomic-commerce-timeframe-facet\n                  {...props<DateFacet>()}\n                ></atomic-commerce-timeframe-facet>\n              );\n            case 'hierarchical':\n              return (\n                <atomic-commerce-category-facet\n                  {...props<CategoryFacet>()}\n                ></atomic-commerce-category-facet>\n              );\n            default: {\n              // TODO COMHUB-291 support location facet\n              this.bindings.engine.logger.warn('Unexpected facet type.');\n              return;\n            }\n          }\n        })}\n      </Fragment>\n    );\n  }\n}\n"],"version":3}