{"version":3,"names":["atomicInsightGeneratedAnswerCss","AtomicInsightGeneratedAnswerStyle0","AtomicInsightGeneratedAnswer","this","DEFAULT_COLLAPSED_HEIGHT","MAX_COLLAPSED_HEIGHT","MIN_COLLAPSED_HEIGHT","copied","copyError","maxCollapsedHeight","onGeneratedAnswerStateUpdate","generatedAnswerState","isVisible","generatedAnswerCommon","data","writeStoredData","setAriaMessage","getGeneratedAnswerStatus","setCopied","isCopied","setCopyError","message","ariaMessage","initialize","GeneratedAnswerCommon","host","withToggle","collapsible","getGeneratedAnswer","generatedAnswer","getGeneratedAnswerState","getSearchStatusState","searchStatusState","getBindings","bindings","getCopied","getCopyError","buildInteractiveCitation","props","buildInsightInteractiveCitation","engine","buildInsightGeneratedAnswer","initialState","responseFormat","contentFormat","answerConfigurationId","searchStatus","buildInsightSearchStatus","insertFeedbackModal","window","ResizeObserver","debouncedAdaptAnswerHeight","debounce","adaptAnswerHeight","resizeObserver","observe","updateAnswerCollapsed","newState","oldState","newExpanded","expanded","oldExpanded","undefined","container","getAnswerContainer","toggleClass","disconnectedCallback","disconnect","element","className","condition","classList","toggle","answerHeight","shadowRoot","querySelector","getBoundingClientRect","height","rootFontSize","parseFloat","getComputedStyle","document","documentElement","fontSize","fullAnswerHeight","updateAnswerHeight","getAnswerFooter","validateMaxCollapsedHeight","isValid","console","warn","setCSSVariable","variableName","value","style","setProperty","footer","maxHeight","isStreaming","render","__decorate","InitializeBindings","BindStateToController","onUpdateCallbackMethod","AriaLiveRegion"],"sources":["src/components/insight/atomic-insight-generated-answer/atomic-insight-generated-answer.pcss?tag=atomic-insight-generated-answer&encapsulation=shadow","src/components/insight/atomic-insight-generated-answer/atomic-insight-generated-answer.tsx"],"sourcesContent":["@import '../../common/generated-answer/styles/generated-answer.pcss';\n","import {\n  SearchStatus as InsightSearchStatus,\n  SearchStatusState as InsightSearchStatusState,\n  buildGeneratedAnswer as buildInsightGeneratedAnswer,\n  buildInteractiveCitation as buildInsightInteractiveCitation,\n  buildSearchStatus as buildInsightSearchStatus,\n  GeneratedAnswer as InsightGeneratedAnswer,\n  GeneratedAnswerState as InsightGeneratedAnswerState,\n} from '@coveo/headless/insight';\nimport {Component, Element, State, Prop, Watch} from '@stencil/core';\nimport {debounce} from '../../../utils/debounce-utils';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {AriaLiveRegion} from '../../../utils/stencil-accessibility-utils';\nimport {GeneratedAnswerCommon} from '../../common/generated-answer/generated-answer-common';\nimport {InsightBindings} from '../atomic-insight-interface/atomic-insight-interface';\n\n/**\n * @internal\n * The `atomic-insight-generated-answer` component uses Coveo Machine Learning (Coveo ML) models to automatically generate an answer to a query executed by the user.\n * For more information, see [About Relevance Generative Answering (RGA)](https://docs.coveo.com/en/n9de0370/)\n *\n * @slot no-answer-message - Lets you pass a custom sorry message when no answer is generated.\n *\n * @part container - The container displaying the generated answer.\n * @part header-label - The header of the generated answer container.\n * @part feedback-button - The \"like\" and \"dislike\" buttons.\n * @part toggle - The switch to toggle the visibility of the generated answer.\n * @part copy-button - The \"Copy answer\" button.\n * @part retry-container - The container for the \"retry\" section.\n * @part generated-text - The text of the generated answer.\n * @part citations-label - The header of the citations list.\n *\n * @part answer-code-block - The generated answer multi-line code blocks.\n * @part answer-emphasis - The generated answer emphasized text elements.\n * @part answer-inline-code - The generated answer inline code elements.\n * @part answer-heading-1 - The generated answer level 1 heading elements.\n * @part answer-heading-2 - The generated answer level 2 heading elements.\n * @part answer-heading-3 - The generated answer level 3 heading elements.\n * @part answer-heading-4 - The generated answer level 4 heading elements.\n * @part answer-heading-5 - The generated answer level 5 heading elements.\n * @part answer-heading-6 - The generated answer level 6 heading elements.\n * @part answer-list-item - The generated answer list item elements for both ordered and unordered lists.\n * @part answer-ordered-list - The generated answer ordered list elements.\n * @part answer-paragraph - The generated answer paragraph elements.\n * @part answer-quote-block - The generated answer quote block elements.\n * @part answer-unordered-list - The generated answer unordered list elements.\n * @part answer-strong - The generated answer strong text elements.\n * @part answer-table - The generated answer table elements.\n * @part answer-table-container - The generated answer table container elements.\n * @part answer-table-content - The generated answer table content cell elements.\n * @part answer-table-header - The generated answer table header cell elements.\n *\n * @part citation - The link that allows the user to navigate to the item.\n * @part citation-popover - The pop-up that shows an item preview when the user hovers over the citation.\n */\n@Component({\n  tag: 'atomic-insight-generated-answer',\n  styleUrl: 'atomic-insight-generated-answer.pcss',\n  shadow: true,\n})\nexport class AtomicInsightGeneratedAnswer\n  implements InitializableComponent<InsightBindings>\n{\n  @InitializeBindings() public bindings!: InsightBindings;\n  public generatedAnswer!: InsightGeneratedAnswer;\n  public searchStatus!: InsightSearchStatus;\n  private resizeObserver?: ResizeObserver;\n\n  private readonly DEFAULT_COLLAPSED_HEIGHT = 16;\n  private readonly MAX_COLLAPSED_HEIGHT = 32;\n  private readonly MIN_COLLAPSED_HEIGHT = 9;\n\n  @BindStateToController('generatedAnswer', {\n    onUpdateCallbackMethod: 'onGeneratedAnswerStateUpdate',\n  })\n  @State()\n  private generatedAnswerState!: InsightGeneratedAnswerState;\n\n  @BindStateToController('searchStatus')\n  @State()\n  private searchStatusState!: InsightSearchStatusState;\n\n  @State()\n  public error!: Error;\n\n  @Element() private host!: HTMLElement;\n\n  @State()\n  copied = false;\n\n  @State()\n  copyError = false;\n\n  /**\n   * Whether to render a toggle button that lets the user hide or show the answer.\n   * @default false\n   */\n  @Prop() withToggle?: boolean;\n\n  /**\n   * Whether to allow the answer to be collapsed when the text is taller than 250px.\n   * @default false\n   */\n  @Prop() collapsible?: boolean;\n\n  /**\n   * The maximum height (in rem units) of the answer when collapsed.\n   *\n   */\n  @Prop() maxCollapsedHeight = this.DEFAULT_COLLAPSED_HEIGHT;\n\n  /**\n   * @internal\n   * The unique identifier of the answer configuration to use to generate the answer.\n   */\n  @Prop() answerConfigurationId?: string;\n\n  @AriaLiveRegion('generated-answer')\n  protected ariaMessage!: string;\n\n  private generatedAnswerCommon!: GeneratedAnswerCommon;\n  private fullAnswerHeight?: number;\n\n  public initialize() {\n    this.generatedAnswerCommon = new GeneratedAnswerCommon({\n      host: this.host,\n      withToggle: this.withToggle,\n      collapsible: this.collapsible,\n      getGeneratedAnswer: () => this.generatedAnswer,\n      getGeneratedAnswerState: () => this.generatedAnswerState,\n      getSearchStatusState: () => this.searchStatusState,\n      getBindings: () => this.bindings,\n      getCopied: () => this.copied,\n      setCopied: this.setCopied,\n      getCopyError: () => this.copyError,\n      setCopyError: this.setCopyError,\n      setAriaMessage: this.setAriaMessage,\n      buildInteractiveCitation: (props) =>\n        buildInsightInteractiveCitation(this.bindings.engine, props),\n    });\n    this.generatedAnswer = buildInsightGeneratedAnswer(this.bindings.engine, {\n      initialState: {\n        isVisible: this.generatedAnswerCommon.data.isVisible,\n        responseFormat: {\n          contentFormat: ['text/markdown', 'text/plain'],\n        },\n      },\n      ...(this.answerConfigurationId && {\n        answerConfigurationId: this.answerConfigurationId,\n      }),\n    });\n    this.searchStatus = buildInsightSearchStatus(this.bindings.engine);\n    this.generatedAnswerCommon.insertFeedbackModal();\n\n    if (window.ResizeObserver && this.collapsible) {\n      const debouncedAdaptAnswerHeight = debounce(\n        () => this.adaptAnswerHeight(),\n        100\n      );\n      this.resizeObserver = new ResizeObserver(debouncedAdaptAnswerHeight);\n      this.resizeObserver.observe(this.host);\n    }\n  }\n\n  @Watch('generatedAnswerState')\n  public updateAnswerCollapsed(\n    newState: InsightGeneratedAnswerState,\n    oldState: InsightGeneratedAnswerState\n  ) {\n    const newExpanded = newState.expanded;\n    const oldExpanded = oldState ? oldState.expanded : undefined;\n\n    if (newExpanded !== oldExpanded) {\n      const container = this.getAnswerContainer();\n\n      if (!container) {\n        return;\n      }\n\n      this.toggleClass(container, 'answer-collapsed', !newExpanded);\n    }\n  }\n\n  public disconnectedCallback() {\n    this.resizeObserver?.disconnect();\n  }\n\n  // @ts-expect-error: This function is used by BindStateToController.\n  private onGeneratedAnswerStateUpdate = () => {\n    if (\n      this.generatedAnswerState.isVisible !==\n      this.generatedAnswerCommon?.data?.isVisible\n    ) {\n      this.generatedAnswerCommon.data = {\n        ...this.generatedAnswerCommon.data,\n        isVisible: this.generatedAnswerState.isVisible,\n      };\n      this.generatedAnswerCommon.writeStoredData(\n        this.generatedAnswerCommon.data\n      );\n    }\n\n    this.setAriaMessage(this.generatedAnswerCommon.getGeneratedAnswerStatus());\n  };\n\n  private setCopied = (isCopied: boolean) => {\n    this.copied = isCopied;\n  };\n\n  private setCopyError = (copyError: boolean) => {\n    this.copyError = copyError;\n  };\n\n  private setAriaMessage = (message: string) => {\n    this.ariaMessage = message;\n  };\n\n  private toggleClass(element: Element, className: string, condition: boolean) {\n    element.classList.toggle(className, condition);\n  }\n\n  private adaptAnswerHeight() {\n    const answerHeight = this.host?.shadowRoot\n      ?.querySelector('[part=\"generated-text\"]')\n      ?.getBoundingClientRect().height;\n\n    if (answerHeight) {\n      const rootFontSize = parseFloat(\n        getComputedStyle(document.documentElement).fontSize\n      );\n\n      this.fullAnswerHeight = answerHeight / rootFontSize;\n\n      this.updateAnswerHeight();\n    }\n  }\n\n  private getAnswerContainer() {\n    return this.host?.shadowRoot?.querySelector('[part=\"generated-container\"]');\n  }\n\n  private getAnswerFooter() {\n    return this.host?.shadowRoot?.querySelector(\n      '[part=\"generated-answer-footer\"]'\n    );\n  }\n\n  private validateMaxCollapsedHeight(): number {\n    const isValid =\n      this.maxCollapsedHeight >= this.MIN_COLLAPSED_HEIGHT &&\n      this.maxCollapsedHeight <= this.MAX_COLLAPSED_HEIGHT;\n\n    if (!isValid) {\n      console.warn(\n        `max-collapsed-height (${this.maxCollapsedHeight}rem) is out of the valid range (${this.MIN_COLLAPSED_HEIGHT}rem - ${this.MAX_COLLAPSED_HEIGHT}rem). Falling back to default value (${this.DEFAULT_COLLAPSED_HEIGHT}rem).`\n      );\n    }\n\n    return isValid ? this.maxCollapsedHeight : this.DEFAULT_COLLAPSED_HEIGHT;\n  }\n\n  private setCSSVariable(variableName: string, value: string) {\n    const container = this.getAnswerContainer();\n    if (container) {\n      (container as HTMLElement).style.setProperty(variableName, value);\n    }\n  }\n\n  private updateAnswerHeight() {\n    const container = this.getAnswerContainer();\n    const footer = this.getAnswerFooter();\n    const maxHeight = this.validateMaxCollapsedHeight();\n\n    if (!container || !footer) {\n      return;\n    }\n\n    if (this.fullAnswerHeight! > maxHeight) {\n      this.setCSSVariable('--atomic-crga-collapsed-height', `${maxHeight}rem`);\n      this.toggleClass(\n        container,\n        'answer-collapsed',\n        !this.generatedAnswerState.expanded\n      );\n      this.toggleClass(footer, 'is-collapsible', true);\n      this.toggleClass(\n        footer,\n        'generating-label-visible',\n        this.generatedAnswerState.isStreaming\n      );\n    } else {\n      this.toggleClass(container, 'answer-collapsed', false);\n      this.toggleClass(footer, 'is-collapsible', false);\n      this.toggleClass(footer, 'generating-label-visible', false);\n    }\n  }\n\n  public render() {\n    return this.generatedAnswerCommon.render();\n  }\n}\n"],"mappings":"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","ignoreList":[]}