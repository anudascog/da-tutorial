import{h as t,r as s,g as e}from"./p-dc3df5ce.js";import{buildInteractiveInstantResult as i,buildInstantResults as r}from"@coveo/headless";import{e as n}from"./p-8f5830b4.js";import{I as o}from"./p-fb84ac1d.js";import{a}from"./p-21ab6f55.js";import{d as h}from"./p-c8eeec5d.js";import"./p-98f20ae6.js";import"./p-c9074946.js";import"./p-1580513b.js";const l=(t,s,e)=>({ariaLabel:t.t("instant-results-suggestion-label",{title:s,interpolation:{escapeValue:false}}),key:`instant-result-${n(e)}`,part:"instant-results-item"});const u=t=>({key:"instant-results-show-all-button",part:"instant-results-show-all",ariaLabel:t.t("show-all-results")});const c=({i18n:s})=>t("div",{part:"instant-results-show-all-button",class:a("text-primary")},s.t("show-all-results"));const m=class{constructor(t){s(this,t);this.results=[];this.display="list";this.templateHasError=false;this.maxResultsPerQuery=4;this.density="normal";this.imageSize="icon";this.error=undefined;this.templateHasError=false;this.maxResultsPerQuery=4;this.density="normal";this.imageSize="icon";this.ariaLabelGenerator=undefined}async setRenderFunction(t){this.itemRenderingFunction=t}componentWillLoad(){try{h((t=>{this.bindings=t;return this.initialize()}),this.host,["atomic-search-box"])}catch(t){this.error=t}}getLink(t){const s=t.tagName==="ATOMIC-RESULT"?t:t?.querySelector("atomic-result");return s?.shadowRoot?.querySelector("atomic-result-link a:not([slot])")||null}handleLinkClick(t,s){const e=s=>t.setAttribute("target",s);const i=t.getAttribute("target");s&&e("_blank");t.click();s&&e(i||"");return true}renderItems(){if(!this.bindings.suggestedQuery()||this.bindings.store.isMobile()){return[]}const s=this.instantResults.state.results.length?this.instantResults.state.results:this.results;const e=s.map((s=>{const e=l(this.bindings.i18n,this.ariaLabelGenerator?.(this.bindings,s)||s.title,s.uniqueId);return{...e,content:t("atomic-result",{key:`instant-result-${n(s.uniqueId)}`,part:"outline",result:s,interactiveResult:i(this.bindings.engine,{options:{result:s}}),display:this.display,density:this.density,imageSize:this.imageSize,content:this.itemTemplateProvider.getTemplateContent(s),stopPropagation:false,renderingFunction:this.itemRenderingFunction}),onSelect:t=>{const s=this.getLink(t.target);if(!s){return}this.handleLinkClick(s,t.ctrlKey||t.metaKey)}}}));if(e.length){const s=u(this.bindings.i18n);e.push({...s,content:t(c,{i18n:this.bindings.i18n}),onSelect:()=>{this.bindings.clearSuggestions();this.bindings.searchBoxController.updateText(this.instantResults.state.q);this.bindings.searchBoxController.submit()}})}return e}initialize(){this.instantResults=r(this.bindings.engine,{options:{maxResultsPerQuery:this.maxResultsPerQuery}});this.itemTemplateProvider=new o({includeDefaultTemplate:true,templateElements:Array.from(this.host.querySelectorAll("atomic-result-template")),getResultTemplateRegistered:()=>true,setResultTemplateRegistered:()=>{},getTemplateHasError:()=>this.templateHasError,setTemplateHasError:t=>{this.templateHasError=t},bindings:this.bindings});return{position:Array.from(this.host.parentNode.children).indexOf(this.host),panel:"right",onSuggestedQueryChange:t=>{this.instantResults.updateQuery(t);return this.onSuggestedQueryChange()},renderItems:()=>this.renderItems()}}onSuggestedQueryChange(){if(!this.bindings.getSuggestionElements().length&&!this.bindings.searchBoxController.state.value){console.warn("There doesn't seem to be any query suggestions configured. Make sure to include either an atomic-search-box-query-suggestions or atomic-search-box-recent-queries in your search box in order to see some instant results.")}return new Promise((t=>{const s=this.instantResults.subscribe((()=>{const e=this.instantResults.state;if(!e.isLoading){if(e.results.length){this.results=e.results}s();t()}}))}))}render(){if(this.error){return t("atomic-component-error",{key:"6e436e6b99962916f27f50ea4182b88260370899",element:this.host,error:this.error})}}get host(){return e(this)}};export{m as atomic_search_box_instant_results};
//# sourceMappingURL=p-177f8010.entry.js.map