{"version":3,"names":["createCommerceRecommendationStore","store","createBaseStore","loadingFlags","iconAssetsPath","resultList","undefined","unsetLoadingFlag","loadingFlag","setLoadingFlag","atomicCommerceRecommendationInterfaceCss","AtomicCommerceRecommendationInterfaceStyle0","AtomicCommerceRecommendationInterface","constructor","hostRef","this","scrollContainer","languageAssetsPath","analytics","commonInterfaceHelper","CommonAtomicInterfaceHelper","promise","componentWillLoadCalledPromise","resolve","componentWillLoadResolver","Promise","withResolvers","i18Initialized","i18n","i18next","createInstance","componentWillLoad","CspNonce","setNonce","initAriaLive","toggleAnalytics","onAnalyticsChange","updateLanguage","engineIsCreated","engine","language","contextController","setLanguage","onLanguageChange","updateIconAssetsPath","state","handleInitialization","event","onComponentInitializing","scrollToTop","scrollContainerElement","document","querySelector","bindings","logger","warn","scrollIntoView","behavior","initializeWithEngine","internalInitialization","interfaceElement","host","addAdoptedStyleSheets","stylesheet","parent","getRootNode","styleSheet","isDocumentOrShadowRoot","Document","ShadowRoot","adoptedStyleSheets","includes","push","initContext","buildContext","initLanguage","Array","from","children","some","element","tagName","ariaLive","createElement","prepend","initEngine","all","onInitialization","markParentAsReady","render","h","key"],"sources":["src/components/commerce/atomic-commerce-recommendation-interface/store.ts","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.pcss?tag=atomic-commerce-recommendation-interface&encapsulation=shadow","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.tsx"],"sourcesContent":["import {\n  BaseStore,\n  createBaseStore,\n  ResultListInfo,\n  setLoadingFlag,\n  unsetLoadingFlag,\n} from '../../common/interface/store';\n\ninterface Data {\n  loadingFlags: string[];\n  iconAssetsPath: string;\n  resultList: ResultListInfo | undefined;\n}\n\nexport type CommerceRecommendationStore = BaseStore<Data> & {\n  unsetLoadingFlag(loadingFlag: string): void;\n  setLoadingFlag(flag: string): void;\n};\n\nexport function createCommerceRecommendationStore(): CommerceRecommendationStore {\n  const store = createBaseStore<Data>({\n    loadingFlags: [],\n    iconAssetsPath: '',\n    resultList: undefined,\n  });\n\n  return {\n    ...store,\n\n    unsetLoadingFlag(loadingFlag: string) {\n      unsetLoadingFlag(store, loadingFlag);\n    },\n\n    setLoadingFlag(loadingFlag: string) {\n      setLoadingFlag(store, loadingFlag);\n    },\n  };\n}\n","@import '../../../global/global.pcss';\n\n:host {\n  display: block;\n  height: inherit;\n  width: inherit;\n  & > slot {\n    height: inherit;\n  }\n}\n","import {markParentAsReady} from '@/src/utils/init-queue.js';\nimport {\n  CommerceEngine,\n  CommerceEngineConfiguration,\n  Context,\n  buildContext,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  Prop,\n  h,\n  Listen,\n  Method,\n  Watch,\n  Element,\n  State,\n  setNonce,\n} from '@stencil/core';\nimport i18next, {i18n} from 'i18next';\nimport {InitializeEvent} from '../../../utils/initialization-utils';\nimport {\n  AdoptedStylesBindings,\n  CommonBindings,\n} from '../../common/interface/bindings';\nimport {\n  StencilBaseAtomicInterface,\n  CommonAtomicInterfaceHelper,\n} from '../../common/interface/interface-common-stencil';\nimport {AtomicCommerceInterface} from '../atomic-commerce-interface/atomic-commerce-interface';\nimport {\n  CommerceRecommendationStore,\n  createCommerceRecommendationStore,\n} from './store';\n\nexport type CommerceInitializationOptions = CommerceEngineConfiguration;\nexport type CommerceBindings = CommonBindings<\n  CommerceEngine,\n  CommerceRecommendationStore,\n  AtomicCommerceInterface\n> &\n  AdoptedStylesBindings;\n\n/**\n * @alpha\n * The `atomic-commerce-recommendation-interface` component is meant to be used as the parent of one or more `atomic-commerce-recommendation-list` components. It handles the headless search engine and localization configurations.\n */\n@Component({\n  tag: 'atomic-commerce-recommendation-interface',\n  styleUrl: 'atomic-commerce-recommendation-interface.pcss',\n  shadow: true,\n  assetsDirs: ['lang'],\n})\nexport class AtomicCommerceRecommendationInterface\n  implements StencilBaseAtomicInterface<CommerceEngine>\n{\n  private store = createCommerceRecommendationStore();\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<CommerceEngine>;\n\n  @Element() public host!: AtomicCommerceInterface;\n\n  @State() public error?: Error;\n\n  /**\n   * The commerce interface i18next instance.\n   */\n  @Prop() public i18n: i18n;\n\n  /**\n   * The commerce interface headless engine.\n   */\n  @Prop({mutable: true}) public engine!: CommerceEngine;\n\n  /**\n   * The CSS selector for the container the interface will scroll back to.\n   */\n  @Prop({reflect: true}) public scrollContainer =\n    'atomic-commerce-recommendation-interface';\n\n  /**\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\n   *\n   * Example: \"/mypublicpath/languages\"\n   *\n   */\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\n\n  /**\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\n   *\n   * Example: \"/mypublicpath/icons\"\n   *\n   */\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\n\n  /**\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\n   * Otherwise you may see console errors such as\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\n   * @example:\n   * ```html\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\n   *  import {setNonce} from '@coveo/atomic';\n   *  setNonce('<YOUR_GENERATED_NONCE>');\n   * </script>\n   * ```\n   */\n  @Prop({reflect: true}) public CspNonce?: string;\n\n  /**\n   * The commerce interface language.\n   *\n   * Will default to the value set in the Headless engine context if not provided.\n   */\n  @Prop({reflect: true, mutable: true}) public language?: string;\n\n  /**\n   * Whether to enable analytics.\n   */\n  @Prop({reflect: true}) public analytics = true;\n\n  private i18Initialized: Promise<void>;\n  private componentWillLoadCalledPromise: Promise<void>;\n  private componentWillLoadResolver: () => void;\n\n  private contextController!: Context;\n\n  public constructor() {\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\n      this,\n      'CoveoAtomic'\n    );\n    ({\n      promise: this.componentWillLoadCalledPromise,\n      resolve: this.componentWillLoadResolver,\n    } = Promise.withResolvers<void>());\n    const {promise, resolve} = Promise.withResolvers<void>();\n    this.i18Initialized = promise;\n    this.i18n = i18next.createInstance(undefined, resolve);\n  }\n\n  componentWillLoad() {\n    if (this.CspNonce) {\n      setNonce(this.CspNonce);\n    }\n    this.initAriaLive();\n    this.componentWillLoadResolver();\n  }\n\n  @Watch('analytics')\n  public toggleAnalytics() {\n    this.commonInterfaceHelper.onAnalyticsChange();\n  }\n\n  @Watch('language')\n  public updateLanguage() {\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\n      return;\n    }\n\n    if (!this.language) {\n      return;\n    }\n\n    this.contextController.setLanguage(this.language);\n\n    return this.commonInterfaceHelper.onLanguageChange();\n  }\n\n  @Watch('iconAssetsPath')\n  public updateIconAssetsPath() {\n    this.store.state.iconAssetsPath = this.iconAssetsPath;\n  }\n\n  @Listen('atomic/initializeComponent')\n  public handleInitialization(event: InitializeEvent) {\n    this.commonInterfaceHelper.onComponentInitializing(event);\n  }\n\n  @Listen('atomic/scrollToTop')\n  public scrollToTop() {\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\n    if (!scrollContainerElement) {\n      this.bindings.engine.logger.warn(\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\n      );\n      return;\n    }\n\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\n  }\n\n  /**\n   * Initializes the connection with an already preconfigured [headless commerce engine](https://docs.coveo.com/en/headless/latest/reference/commerce/).\n   */\n  @Method() public initializeWithEngine(engine: CommerceEngine) {\n    return this.internalInitialization(() => (this.engine = engine));\n  }\n\n  public get bindings(): CommerceBindings {\n    return {\n      engine: this.engine!,\n      i18n: this.i18n,\n      store: this.store,\n      interfaceElement: this.host,\n      addAdoptedStyleSheets: (stylesheet) => {\n        const parent = this.host.getRootNode();\n        const styleSheet = stylesheet;\n        const isDocumentOrShadowRoot =\n          parent instanceof Document || parent instanceof ShadowRoot;\n\n        if (\n          styleSheet &&\n          isDocumentOrShadowRoot &&\n          !parent.adoptedStyleSheets.includes(styleSheet)\n        ) {\n          parent.adoptedStyleSheets.push(styleSheet);\n        }\n      },\n    };\n  }\n\n  private initContext() {\n    this.contextController = buildContext(this.bindings.engine);\n  }\n\n  private initLanguage() {\n    if (!this.language) {\n      this.language = this.contextController.state.language;\n    }\n  }\n\n  private initAriaLive() {\n    if (\n      Array.from(this.host.children).some(\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\n      )\n    ) {\n      return;\n    }\n    const ariaLive = document.createElement('atomic-aria-live');\n    this.host.prepend(ariaLive);\n  }\n\n  private async internalInitialization(initEngine: () => void) {\n    await this.componentWillLoadCalledPromise;\n    await Promise.all([\n      this.commonInterfaceHelper.onInitialization(initEngine),\n      this.i18Initialized,\n    ]);\n    this.initContext();\n    await this.updateLanguage();\n    markParentAsReady(this.host);\n\n    this.initLanguage();\n  }\n\n  public render() {\n    return [<slot></slot>];\n  }\n}\n"],"mappings":"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","ignoreList":[]}