{"version":3,"names":["parseValue","product","field","value","ProductTemplatesHelpers","getProductProperty","valueAsNumber","parseFloat","Number","isNaN","FieldValueIsNaNError","getStringValueFromProductOrNull","trim","buildStringTemplateFromProduct","template","bindings","replace","key","substring","length","newValue","readFromObject","window","engine","logger","warn","permanentid"],"sources":["src/components/commerce/product-template-components/product-utils.ts"],"sourcesContent":["import {Product, ProductTemplatesHelpers} from '@coveo/headless/commerce';\nimport {readFromObject} from '../../../utils/object-utils';\nimport {CommerceBindings} from '../atomic-commerce-interface/atomic-commerce-interface';\nimport {FieldValueIsNaNError} from './error';\n\nexport function parseValue(product: Product, field: string) {\n  const value = ProductTemplatesHelpers.getProductProperty(product, field);\n  if (value === null) {\n    return null;\n  }\n  const valueAsNumber = parseFloat(`${value}`);\n  if (Number.isNaN(valueAsNumber)) {\n    throw new FieldValueIsNaNError(field, value);\n  }\n  return valueAsNumber;\n}\n\nexport function getStringValueFromProductOrNull(\n  product: Product,\n  field: string\n) {\n  const value = ProductTemplatesHelpers.getProductProperty(product, field);\n\n  if (typeof value !== 'string' || value.trim() === '') {\n    return null;\n  }\n\n  return value;\n}\n\nexport function buildStringTemplateFromProduct(\n  template: string,\n  product: Product,\n  bindings: CommerceBindings\n) {\n  return template.replace(/\\${(.*?)}/g, (value: string) => {\n    const key = value.substring(2, value.length - 1);\n    let newValue = readFromObject(product, key);\n    if (!newValue && typeof window !== 'undefined') {\n      newValue = readFromObject(window, key);\n    }\n\n    if (!newValue) {\n      bindings.engine.logger.warn(\n        `${key} used in the href template is undefined for this product: ${product.permanentid} and could not be found in the window object.`\n      );\n      return '';\n    }\n\n    return newValue;\n  });\n}\n"],"mappings":"oJAKgBA,EAAWC,EAAkBC,GAC3C,MAAMC,EAAQC,EAAwBC,mBAAmBJ,EAASC,GAClE,GAAIC,IAAU,KAAM,CAClB,OAAO,I,CAET,MAAMG,EAAgBC,WAAW,GAAGJ,KACpC,GAAIK,OAAOC,MAAMH,GAAgB,CAC/B,MAAM,IAAII,EAAqBR,EAAOC,E,CAExC,OAAOG,CACT,C,SAEgBK,EACdV,EACAC,GAEA,MAAMC,EAAQC,EAAwBC,mBAAmBJ,EAASC,GAElE,UAAWC,IAAU,UAAYA,EAAMS,SAAW,GAAI,CACpD,OAAO,I,CAGT,OAAOT,CACT,C,SAEgBU,EACdC,EACAb,EACAc,GAEA,OAAOD,EAASE,QAAQ,cAAeb,IACrC,MAAMc,EAAMd,EAAMe,UAAU,EAAGf,EAAMgB,OAAS,GAC9C,IAAIC,EAAWC,EAAepB,EAASgB,GACvC,IAAKG,UAAmBE,SAAW,YAAa,CAC9CF,EAAWC,EAAeC,OAAQL,E,CAGpC,IAAKG,EAAU,CACbL,EAASQ,OAAOC,OAAOC,KACrB,GAAGR,8DAAgEhB,EAAQyB,4DAE7E,MAAO,E,CAGT,OAAON,CAAQ,GAEnB,Q","ignoreList":[]}