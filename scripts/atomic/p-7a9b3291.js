import{h as t}from"./p-dc3df5ce.js";import{p as s}from"./p-10f62f16.js";import{g as e}from"./p-55d2bcf3.js";import{r as i}from"./p-cbd58764.js";import{H as r}from"./p-d6e6dbc3.js";import{F as h,b as a,a as n}from"./p-1cb2280d.js";import{F as u}from"./p-d4c2b7c0.js";import{F as l}from"./p-a7301a38.js";import{F as o}from"./p-2a02812b.js";import{i as d}from"./p-406f7e5a.js";import{b as c}from"./p-66f4521a.js";class f{constructor(t){this.props=t;this.manualTimeframes=[];this.facetId=this.determineFacetId;this.props.setFacetId(this.facetId);this.manualTimeframes=this.getManualTimeframes();if(this.manualTimeframes.length>0){this.facetForDateRange=this.props.initializeFacetForDateRange(this.currentValues)}if(this.props.withDatePicker){this.facetForDatePicker=this.props.initializeFacetForDatePicker();this.facetForDatePickerDependenciesManager=this.props.buildDependenciesManager(this.facetForDatePicker.state.facetId);this.filter=this.props.initializeFilter()}if(this.facetForDateRange){this.facetForDateRangeDependenciesManager=this.props.buildDependenciesManager(this.facetForDateRange?.state.facetId)}if(this.filter){this.filterDependenciesManager=this.props.buildDependenciesManager(this.filter?.state.facetId)}this.registerFacetToStore()}get determineFacetId(){if(this.props.facetId){return this.props.facetId}if(this.props.bindings.store.state.dateFacets[this.props.field]){return i(`${this.props.field}_`)}return this.props.field}get enabled(){return this.facetForDateRange?.state.enabled??this.filter?.state.enabled??true}get valuesToRender(){return this.facetForDateRange?.state.values.filter((t=>t.numberOfResults||t.state!=="idle"))||[]}get shouldRenderValues(){return!this.hasInputRange&&!!this.valuesToRender.length}get shouldRenderFacet(){return this.shouldRenderInput||this.shouldRenderValues}get shouldRenderInput(){return c({hasInput:this.props.withDatePicker,hasInputRange:this.hasInputRange,searchStatusState:this.props.getSearchStatusState(),facetValues:this.facetForDatePicker?.state?.values||[]})}get hasValues(){if(this.facetForDatePicker?.state.values.length){return true}return!!this.valuesToRender.length}get numberOfSelectedValues(){if(this.filter?.state?.range){return 1}return this.facetForDateRange?.state.values.filter((({state:t})=>t==="selected")).length||0}get hasInputRange(){return!!this.filter?.state.range}get currentValues(){return this.manualTimeframes.map((({period:t,amount:s,unit:e})=>t==="past"?this.props.buildDateRange({start:{period:t,unit:e,amount:s},end:{period:"now"}}):this.props.buildDateRange({start:{period:"now"},end:{period:t,unit:e,amount:s}})))}disconnectedCallback(){if(this.props.host.isConnected){return}this.facetForDateRangeDependenciesManager?.stopWatching();this.facetForDatePickerDependenciesManager?.stopWatching();this.filterDependenciesManager?.stopWatching()}get isHidden(){return!this.shouldRenderFacet||!this.enabled}registerFacetToStore(){const t={label:()=>this.props.bindings.i18n.t(this.props.label),facetId:this.facetId,element:this.props.host,isHidden:()=>this.isHidden};this.props.bindings.store.registerFacet("dateFacets",{...t,format:t=>this.formatFacetValue(t)});d(this.props.host,{...t,hasValues:()=>this.hasValues,numberOfActiveValues:()=>this.numberOfSelectedValues});if(this.filter){this.props.bindings.store.state.dateFacets[this.filter.state.facetId]=this.props.bindings.store.state.dateFacets[this.facetId]}}getManualTimeframes(){return Array.from(this.props.host.querySelectorAll("atomic-timeframe")).map((({label:t,amount:s,unit:e,period:i})=>({label:t,amount:s,unit:e,period:i})))}formatFacetValue(t){try{const s=this.props.deserializeRelativeDate(t.start);const i=s.period==="past"?s:this.props.deserializeRelativeDate(t.end);const r=this.getManualTimeframes().find((t=>t.period===i.period&&t.unit===i.unit&&t.amount===i.amount));if(r?.label){return e(this.props.field,r.label,this.props.bindings.i18n)}return this.props.bindings.i18n.t(`${i.period}-${i.unit}`,{count:i.amount})}catch(e){return this.props.bindings.i18n.t("to",{start:s(t.start).format("YYYY-MM-DD"),end:s(t.end).format("YYYY-MM-DD")})}}renderValues(){return this.renderValuesContainer(this.valuesToRender.map((t=>this.renderValue(t))))}renderValue(s){const e=this.formatFacetValue(s);const i=s.state==="selected";const r=s.state==="excluded";return t(l,{displayValue:e,isSelected:i,numberOfResults:s.numberOfResults,i18n:this.props.bindings.i18n,onClick:()=>this.facetForDateRange.toggleSingleSelect(s)},t(u,{displayValue:e,isSelected:i,isExcluded:r}))}renderValuesContainer(s){return t(o,{i18n:this.props.bindings.i18n,label:this.props.label},t("ul",{class:"mt-3",part:"values"},s))}renderHeader(s,e,i){return t(h,{i18n:this.props.bindings.i18n,label:this.props.label,onClearFilters:()=>{e.focusAfterSearch();if(this.filter?.state.range){this.filter?.clear();return}this.facetForDateRange?.deselectAll()},numberOfActiveValues:this.numberOfSelectedValues,isCollapsed:s,headingLevel:this.props.headingLevel,onToggleCollapse:i,headerRef:t=>e.setTarget(t)})}renderDateInput(){return t("atomic-facet-date-input",{min:this.props.min,max:this.props.max,bindings:this.props.bindings,label:this.props.label,facetId:this.filter.state.facetId,rangeGetter:()=>this.filter.state.range,rangeSetter:t=>{this.filter.setRange(t)}})}render({hasError:s,firstSearchExecuted:e,isCollapsed:i,headerFocus:h,onToggleCollapse:u}){if(s||!this.enabled){return t(r,null)}if(!e){return t(a,{numberOfValues:this.currentValues.length,isCollapsed:i})}if(!this.shouldRenderFacet){return t(r,null)}return t(n,null,this.renderHeader(i,h,u),!i&&[this.shouldRenderValues&&this.renderValues(),this.shouldRenderInput&&this.renderDateInput()])}}export{f as T};
//# sourceMappingURL=p-7a9b3291.js.map