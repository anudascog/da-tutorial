import{ProductTemplatesHelpers as t}from"@coveo/headless/commerce";import"./p-f284897c.js";import{e,f as n,a as o}from"./p-cbd58764.js";import{h as r}from"./p-dc3df5ce.js";import{t as i}from"./p-acd1a1d3.js";import{i as s}from"./p-589f3bd5.js";function c(t,e){const n=new Set;for(const o of t){if(e.has(o)){n.add(o)}}return n}function a(e,n){const o=[];for(const r in e){if(n[r]){const t=new Set(n[r]);const o=new Set(e[r]);const i=c(t,o);if(i.size>0){console.error(`Conflicting match conditions for field ${r}, the template will be ignored.`,i);return[()=>false]}}o.push(t.fieldMustMatch(r,e[r]))}for(const e in n){o.push(t.fieldMustNotMatch(e,n[e]))}return o}function l(t){if(s(t)){return"section"}if(!n(t)){return"metadata"}if(o(t)&&t.tagName.toLowerCase()===i){return"table-column-definition"}return"other"}function f(t){return e(Array.from(t),(t=>l(t)))}class m{constructor({host:t,setError:e,validParents:n,allowEmpty:o=false}){this.matchConditions=[];this.host=t;this.validateTemplate(t,e,n,o)}validateTemplate(t,e,n,o=true){const r=n.map((t=>t.toUpperCase())).includes(t.parentElement?.nodeName||"");const i=t.nodeName.toLowerCase();if(!r){e(new Error(`The "${i}" component has to be the child of one of the following: ${n.map((t=>`"${t.toLowerCase()}"`)).join(", ")}.`));return}if(t.parentElement?.attributes.getNamedItem("display")?.value==="grid"){this.gridCellLinkTarget=t.parentElement?.attributes.getNamedItem("grid-cell-link-target")?.value}const s=t.querySelector("template");if(!s){e(new Error(`The "${i}" component must contain a "template" element as a child.`));return}if(!o&&!s.innerHTML.trim()){e(new Error(`The "template" tag inside "${i}" cannot be empty.`));return}if(s.content.querySelector("script")){console.warn('Any "script" tags defined inside of "template" elements are not supported and will not be executed when the products are rendered.',t)}const{section:c,other:a}=f(s.content.childNodes);if(c?.length&&a?.length){console.warn("Product templates should only contain section elements or non-section elements. Future updates could unpredictably affect this product template.",t,{sectionNodes:c,otherNodes:a})}}getTemplate(t,e){if(e){return null}return{conditions:t.concat(this.matchConditions),content:u(this.host).content,linkContent:this.getLinkTemplateElement(this.host).content,priority:1}}renderIfError(t){if(t){return r("atomic-component-error",{element:this.host,error:t})}}getDefaultLinkTemplateElement(){const t=document.createElement("template");t.innerHTML=`<atomic-product-link>${this.gridCellLinkTarget?`<a slot="attributes" target="${this.gridCellLinkTarget}"></a>`:""}</atomic-product-link>`;return t}getLinkTemplateElement(t){return t.querySelector('template[slot="link"]')??this.getDefaultLinkTemplateElement()}}function u(t){return t.querySelector("template:not([slot])")}function p(e,n){const o=[];if(e){const n=e.split(",");o.push(t.fieldsMustBeDefined(n))}if(n){const e=n.split(",");o.push(t.fieldsMustNotBeDefined(e))}return o}export{m as P,a,p as m};
//# sourceMappingURL=p-4d96d200.js.map