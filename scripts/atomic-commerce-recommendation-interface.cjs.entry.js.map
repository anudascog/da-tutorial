{"file":"atomic-commerce-recommendation-interface.entry.cjs.js","mappings":"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","names":["store","createBaseStore","unsetLoadingFlag","setLoadingFlag","CommonAtomicInterfaceHelper","i18next","setNonce","buildContext","markParentAsReady","h"],"sources":["src/components/commerce/atomic-commerce-recommendation-interface/store.ts","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.pcss?tag=atomic-commerce-recommendation-interface&encapsulation=shadow","src/components/commerce/atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface.tsx"],"sourcesContent":["import {\n  BaseStore,\n  createBaseStore,\n  ResultListInfo,\n  setLoadingFlag,\n  unsetLoadingFlag,\n} from '../../common/interface/store';\n\ninterface Data {\n  loadingFlags: string[];\n  iconAssetsPath: string;\n  resultList: ResultListInfo | undefined;\n}\n\nexport type CommerceRecommendationStore = BaseStore<Data> & {\n  unsetLoadingFlag(loadingFlag: string): void;\n  setLoadingFlag(flag: string): void;\n};\n\nexport function createCommerceRecommendationStore(): CommerceRecommendationStore {\n  const store = createBaseStore<Data>({\n    loadingFlags: [],\n    iconAssetsPath: '',\n    resultList: undefined,\n  });\n\n  return {\n    ...store,\n\n    unsetLoadingFlag(loadingFlag: string) {\n      unsetLoadingFlag(store, loadingFlag);\n    },\n\n    setLoadingFlag(loadingFlag: string) {\n      setLoadingFlag(store, loadingFlag);\n    },\n  };\n}\n","@import '../../../global/global.pcss';\n\n:host {\n  display: block;\n  height: inherit;\n  width: inherit;\n  & > slot {\n    height: inherit;\n  }\n}\n","import {markParentAsReady} from '@/src/utils/init-queue.js';\nimport {\n  CommerceEngine,\n  CommerceEngineConfiguration,\n  Context,\n  buildContext,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  Prop,\n  h,\n  Listen,\n  Method,\n  Watch,\n  Element,\n  State,\n  setNonce,\n} from '@stencil/core';\nimport i18next, {i18n} from 'i18next';\nimport {InitializeEvent} from '../../../utils/initialization-utils';\nimport {\n  AdoptedStylesBindings,\n  CommonBindings,\n} from '../../common/interface/bindings';\nimport {\n  StencilBaseAtomicInterface,\n  CommonAtomicInterfaceHelper,\n} from '../../common/interface/interface-common-stencil';\nimport {AtomicCommerceInterface} from '../atomic-commerce-interface/atomic-commerce-interface';\nimport {\n  CommerceRecommendationStore,\n  createCommerceRecommendationStore,\n} from './store';\n\nexport type CommerceInitializationOptions = CommerceEngineConfiguration;\nexport type CommerceBindings = CommonBindings<\n  CommerceEngine,\n  CommerceRecommendationStore,\n  AtomicCommerceInterface\n> &\n  AdoptedStylesBindings;\n\n/**\n * @alpha\n * The `atomic-commerce-recommendation-interface` component is meant to be used as the parent of one or more `atomic-commerce-recommendation-list` components. It handles the headless search engine and localization configurations.\n */\n@Component({\n  tag: 'atomic-commerce-recommendation-interface',\n  styleUrl: 'atomic-commerce-recommendation-interface.pcss',\n  shadow: true,\n  assetsDirs: ['lang'],\n})\nexport class AtomicCommerceRecommendationInterface\n  implements StencilBaseAtomicInterface<CommerceEngine>\n{\n  private store = createCommerceRecommendationStore();\n  private commonInterfaceHelper: CommonAtomicInterfaceHelper<CommerceEngine>;\n\n  @Element() public host!: AtomicCommerceInterface;\n\n  @State() public error?: Error;\n\n  /**\n   * The commerce interface i18next instance.\n   */\n  @Prop() public i18n: i18n;\n\n  /**\n   * The commerce interface headless engine.\n   */\n  @Prop({mutable: true}) public engine!: CommerceEngine;\n\n  /**\n   * The CSS selector for the container the interface will scroll back to.\n   */\n  @Prop({reflect: true}) public scrollContainer =\n    'atomic-commerce-recommendation-interface';\n\n  /**\n   * The language assets path. By default, this will be a relative URL pointing to `./lang`.\n   *\n   * Example: \"/mypublicpath/languages\"\n   *\n   */\n  @Prop({reflect: true}) public languageAssetsPath = './lang';\n\n  /**\n   * The icon assets path. By default, this will be a relative URL pointing to `./assets`.\n   *\n   * Example: \"/mypublicpath/icons\"\n   *\n   */\n  @Prop({reflect: true}) public iconAssetsPath = './assets';\n\n  /**\n   * The value to set the [nonce](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/nonce) attribute to on inline script and style elements generated by this interface and its child components.\n   * If your application is served with a Content Security Policy (CSP) that doesn't include the `script-src: 'unsafe-inline'` or `style-src: 'unsafe-inline'` directives,\n   * you should ensure that your application server generates a new nonce on every page load and uses the generated value to set this prop and serve the corresponding CSP response headers\n   * (i.e., script-src 'nonce-<YOUR_GENERATED_NONCE>' and style-src 'nonce-<YOUR_GENERATED_NONCE>').\n   * Otherwise you may see console errors such as\n   *  - Refused to execute inline script because it violates the following Content Security Policy directive: [...]\n   *  - Refused to apply inline style because it violates the following Content Security Policy directive: [...].\n   * @example:\n   * ```html\n   * <script nonce=\"<YOUR_GENERATED_NONCE>\">\n   *  import {setNonce} from '@coveo/atomic';\n   *  setNonce('<YOUR_GENERATED_NONCE>');\n   * </script>\n   * ```\n   */\n  @Prop({reflect: true}) public CspNonce?: string;\n\n  /**\n   * The commerce interface language.\n   *\n   * Will default to the value set in the Headless engine context if not provided.\n   */\n  @Prop({reflect: true, mutable: true}) public language?: string;\n\n  /**\n   * Whether to enable analytics.\n   */\n  @Prop({reflect: true}) public analytics = true;\n\n  private i18Initialized: Promise<void>;\n  private componentWillLoadCalledPromise: Promise<void>;\n  private componentWillLoadResolver: () => void;\n\n  private contextController!: Context;\n\n  public constructor() {\n    this.commonInterfaceHelper = new CommonAtomicInterfaceHelper(\n      this,\n      'CoveoAtomic'\n    );\n    ({\n      promise: this.componentWillLoadCalledPromise,\n      resolve: this.componentWillLoadResolver,\n    } = Promise.withResolvers<void>());\n    const {promise, resolve} = Promise.withResolvers<void>();\n    this.i18Initialized = promise;\n    this.i18n = i18next.createInstance(undefined, resolve);\n  }\n\n  componentWillLoad() {\n    if (this.CspNonce) {\n      setNonce(this.CspNonce);\n    }\n    this.initAriaLive();\n    this.componentWillLoadResolver();\n  }\n\n  @Watch('analytics')\n  public toggleAnalytics() {\n    this.commonInterfaceHelper.onAnalyticsChange();\n  }\n\n  @Watch('language')\n  public updateLanguage() {\n    if (!this.commonInterfaceHelper.engineIsCreated(this.engine)) {\n      return;\n    }\n\n    if (!this.language) {\n      return;\n    }\n\n    this.contextController.setLanguage(this.language);\n\n    return this.commonInterfaceHelper.onLanguageChange();\n  }\n\n  @Watch('iconAssetsPath')\n  public updateIconAssetsPath() {\n    this.store.state.iconAssetsPath = this.iconAssetsPath;\n  }\n\n  @Listen('atomic/initializeComponent')\n  public handleInitialization(event: InitializeEvent) {\n    this.commonInterfaceHelper.onComponentInitializing(event);\n  }\n\n  @Listen('atomic/scrollToTop')\n  public scrollToTop() {\n    const scrollContainerElement = document.querySelector(this.scrollContainer);\n    if (!scrollContainerElement) {\n      this.bindings.engine.logger.warn(\n        `Could not find the scroll container with the selector \"${this.scrollContainer}\". This will prevent UX interactions that require a scroll from working correctly. Please check the CSS selector in the scrollContainer option`\n      );\n      return;\n    }\n\n    scrollContainerElement.scrollIntoView({behavior: 'smooth'});\n  }\n\n  /**\n   * Initializes the connection with an already preconfigured [headless commerce engine](https://docs.coveo.com/en/headless/latest/reference/commerce/).\n   */\n  @Method() public initializeWithEngine(engine: CommerceEngine) {\n    return this.internalInitialization(() => (this.engine = engine));\n  }\n\n  public get bindings(): CommerceBindings {\n    return {\n      engine: this.engine!,\n      i18n: this.i18n,\n      store: this.store,\n      interfaceElement: this.host,\n      addAdoptedStyleSheets: (stylesheet) => {\n        const parent = this.host.getRootNode();\n        const styleSheet = stylesheet;\n        const isDocumentOrShadowRoot =\n          parent instanceof Document || parent instanceof ShadowRoot;\n\n        if (\n          styleSheet &&\n          isDocumentOrShadowRoot &&\n          !parent.adoptedStyleSheets.includes(styleSheet)\n        ) {\n          parent.adoptedStyleSheets.push(styleSheet);\n        }\n      },\n    };\n  }\n\n  private initContext() {\n    this.contextController = buildContext(this.bindings.engine);\n  }\n\n  private initLanguage() {\n    if (!this.language) {\n      this.language = this.contextController.state.language;\n    }\n  }\n\n  private initAriaLive() {\n    if (\n      Array.from(this.host.children).some(\n        (element) => element.tagName === 'ATOMIC-ARIA-LIVE'\n      )\n    ) {\n      return;\n    }\n    const ariaLive = document.createElement('atomic-aria-live');\n    this.host.prepend(ariaLive);\n  }\n\n  private async internalInitialization(initEngine: () => void) {\n    await this.componentWillLoadCalledPromise;\n    await Promise.all([\n      this.commonInterfaceHelper.onInitialization(initEngine),\n      this.i18Initialized,\n    ]);\n    this.initContext();\n    await this.updateLanguage();\n    markParentAsReady(this.host);\n\n    this.initLanguage();\n  }\n\n  public render() {\n    return [<slot></slot>];\n  }\n}\n"],"version":3}