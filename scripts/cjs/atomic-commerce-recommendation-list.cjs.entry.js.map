{"file":"atomic-commerce-recommendation-list.entry.cjs.js","mappings":"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","names":["randomID","buildRecommendations","ProductTemplateProvider","ItemListCommon","createAppLoadedListener","FocusTargetController","NumberValue","h","Heading","getItemListDisplayClasses","DisplayGrid","DisplayWrapper","ResultsPlaceholdersGuard","ItemDisplayGuard","Hidden","Fragment","Carousel","InitializeBindings","BindStateToController"],"sources":["src/components/commerce/atomic-commerce-recommendation-list/atomic-commerce-recommendation-list.pcss?tag=atomic-commerce-recommendation-list&encapsulation=shadow","src/components/commerce/atomic-commerce-recommendation-list/atomic-commerce-recommendation-list.tsx"],"sourcesContent":["@import '../../../global/global.pcss';\n@import '../../common/item-list/styles/mixins.pcss';\n@import '../../common/item-list/styles/placeholders.pcss';\n\n:host {\n  @apply atomic-grid-clickable-elements;\n  @apply atomic-grid-display-common;\n\n  /**\n * @prop --atomic-recs-number-of-columns: Number of columns for the recommendation list.\n */\n  .list-root {\n    @apply atomic-grid-with-cards;\n    grid-template-columns: repeat(var(--atomic-recs-number-of-columns, 1), minmax(0, 1fr));\n  }\n\n  [part='label'] {\n    @apply font-sans text-2xl font-bold;\n  }\n\n  atomic-product:not(.hydrated) {\n    visibility: hidden;\n  }\n}\n","import {NumberValue} from '@coveo/bueno';\nimport {\n  Product,\n  Recommendations,\n  RecommendationsState,\n  buildRecommendations,\n} from '@coveo/headless/commerce';\nimport {\n  Component,\n  Element,\n  Fragment,\n  Listen,\n  Method,\n  Prop,\n  State,\n  Watch,\n  h,\n} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../utils/initialization-utils';\nimport {FocusTargetController} from '../../../utils/stencil-accessibility-utils';\nimport {randomID} from '../../../utils/utils';\nimport {ResultsPlaceholdersGuard} from '../../common/atomic-result-placeholder/stencil-placeholders';\nimport {createAppLoadedListener} from '../../common/interface/store';\nimport {ItemDisplayGuard} from '../../common/item-list/item-display-guard';\nimport {DisplayGrid} from '../../common/item-list/stencil-display-grid';\nimport {DisplayWrapper} from '../../common/item-list/stencil-display-wrapper';\nimport {\n  ItemListCommon,\n  ItemRenderingFunction,\n} from '../../common/item-list/stencil-item-list-common';\nimport {\n  ItemDisplayBasicLayout,\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n  getItemListDisplayClasses,\n} from '../../common/layout/display-options';\nimport {Carousel} from '../../common/stencil-carousel';\nimport {Heading} from '../../common/stencil-heading';\nimport {Hidden} from '../../common/stencil-hidden';\nimport {CommerceBindings} from '../atomic-commerce-recommendation-interface/atomic-commerce-recommendation-interface';\nimport {ProductTemplateProvider} from '../product-list/product-template-provider';\nimport {SelectChildProductEventArgs} from '../product-template-components/atomic-product-children/select-child-product-event';\n\n/**\n * The `atomic-commerce-recommendation-list` component displays a list of product recommendations by applying one or more product templates.\n * @alpha\n *\n * @part result-list - The element containing the list of product recommendations.\n * @part result-list-grid-clickable-container - The parent of a recommended product and the clickable link encompassing it.\n * @part result-list-grid-clickable - The clickable link encompassing a recommended product.\n * @part label - The label of the recommendation list.\n * @part previous-button - The previous button.\n * @part next-button - The next button.\n * @part indicators - The list of indicators.\n * @part indicator - A single indicator.\n * @part active-indicator - The active indicator.\n *\n * @slot default - The default slot where the product templates are defined.\n */\n@Component({\n  tag: 'atomic-commerce-recommendation-list',\n  styleUrl: 'atomic-commerce-recommendation-list.pcss',\n  shadow: true,\n})\nexport class AtomicCommerceRecommendationList\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n  public recommendations!: Recommendations;\n  private loadingFlag = randomID('firstRecommendationLoaded-');\n  private itemRenderingFunction: ItemRenderingFunction;\n  private nextNewProductTarget?: FocusTargetController;\n  private productTemplateProvider!: ProductTemplateProvider;\n  private itemListCommon!: ItemListCommon;\n\n  @Element() public host!: HTMLDivElement;\n\n  @BindStateToController('recommendations')\n  @State()\n  public recommendationsState!: RecommendationsState;\n  @State() public error!: Error;\n  @State() private isAppLoaded = false;\n  @State() private productTemplateRegistered = false;\n  @State() private templateHasError = false;\n  @State() private currentPage = 0;\n\n  /**\n   * The identifier used by the Commerce API to retrieve the desired recommendation list for the component.\n   * You can configure recommendation lists and get their respective slot IDs through the Coveo Merchandising Hub (CMH).\n   * You can include multiple `atomic-commerce-recommendation-list` components with different slot IDs in the same page to display several recommendation lists.\n   */\n  @Prop({reflect: true})\n  public slotId = 'Recommendation';\n\n  /**\n   * The unique identifier of the product to use for seeded recommendations.\n   */\n  @Prop({reflect: true})\n  public productId?: string;\n\n  /**\n   * The layout to apply when displaying the products. This does not affect the display of the surrounding list itself.\n   * To modify the number of products per column, modify the `--atomic-recs-number-of-columns` CSS variable.\n   */\n  @Prop({reflect: true}) public display: ItemDisplayBasicLayout = 'list';\n  /**\n   * The spacing of various elements in the product list, including the gap between products, the gap between parts of a product, and the font sizes of the parts of a product.\n   */\n  @Prop({reflect: true}) public density: ItemDisplayDensity = 'normal';\n  /**\n   * The expected size of the image displayed on the recommended products.\n   */\n  @Prop({reflect: true})\n  public imageSize: ItemDisplayImageSize = 'small';\n\n  /**\n   * The number of products to display per page.\n   * The products will be displayed in a carousel if this property is set.\n   * This does not affect the display of the list itself, only the number of recommendation pages.\n   * If you want to display the recommendations in a carousel with a single row, set the `--atomic-recs-number-fof-columns` CSS variable to the same value as this property.\n   */\n  @Prop({reflect: true}) public productsPerPage?: number;\n\n  /**\n   * The [heading level](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/Heading_Elements) to use for the heading label, from 1 to 6.\n   */\n  @Prop({reflect: true}) public headingLevel = 0;\n\n  @Watch('productsPerPage')\n  public async watchNumberOfRecommendationsPerPage() {\n    this.currentPage = 0;\n  }\n\n  /**\n   * Sets a rendering function to bypass the standard HTML template mechanism when rendering products.\n   * You can use this function while working with web frameworks that don't use plain HTML syntax, e.g., React, Angular, or Vue.\n   *\n   * Do not use this method if you integrate Atomic in a plain HTML implementation.\n   *\n   * @param productRenderingFunction\n   */\n  @Method() public async setRenderFunction(\n    productRenderingFunction: ItemRenderingFunction\n  ) {\n    this.itemRenderingFunction = productRenderingFunction;\n  }\n\n  /**\n   * Moves to the previous page, when the carousel is activated.\n   */\n  @Method() public async previousPage() {\n    this.currentPage =\n      this.currentPage - 1 < 0 ? this.numberOfPages - 1 : this.currentPage - 1;\n  }\n\n  /**\n   * Moves to the next page, when the carousel is activated.\n   */\n  @Method() public async nextPage() {\n    this.currentPage = (this.currentPage + 1) % this.numberOfPages;\n  }\n\n  public initialize() {\n    this.validateProductsPerPage();\n    this.validateSlotID();\n\n    this.recommendations = buildRecommendations(this.bindings.engine, {\n      options: {\n        slotId: this.slotId,\n        productId: this.productId,\n      },\n    });\n\n    this.recommendations.refresh();\n\n    this.productTemplateProvider = new ProductTemplateProvider({\n      includeDefaultTemplate: true,\n      templateElements: Array.from(\n        this.host.querySelectorAll('atomic-product-template')\n      ),\n      getResultTemplateRegistered: () => this.productTemplateRegistered,\n      getTemplateHasError: () => this.templateHasError,\n      setResultTemplateRegistered: (value: boolean) => {\n        this.productTemplateRegistered = value;\n      },\n      setTemplateHasError: (value: boolean) => {\n        this.templateHasError = value;\n      },\n    });\n\n    this.itemListCommon = new ItemListCommon({\n      engineSubscribe: this.bindings.engine.subscribe,\n      getCurrentNumberOfItems: () => this.recommendationsState.products.length,\n      getIsLoading: () => this.recommendationsState.isLoading,\n      host: this.host,\n      loadingFlag: this.loadingFlag,\n      nextNewItemTarget: this.focusTarget,\n      store: this.bindings.store,\n    });\n    createAppLoadedListener(this.bindings.store, (isAppLoaded) => {\n      this.isAppLoaded = isAppLoaded;\n    });\n  }\n\n  @Listen('atomic/selectChildProduct')\n  public onSelectChildProduct(event: CustomEvent<SelectChildProductEventArgs>) {\n    event.stopPropagation();\n\n    this.recommendations.promoteChildToParent(event.detail.child);\n  }\n\n  public get focusTarget() {\n    if (!this.nextNewProductTarget) {\n      this.nextNewProductTarget = new FocusTargetController(this);\n    }\n    return this.nextNewProductTarget;\n  }\n\n  private get augmentedRecommendationListState() {\n    return {\n      ...this.recommendationsState,\n      firstRequestExecuted: this.recommendationsState.responseId !== '',\n      hasError: this.recommendationsState.error !== null,\n      hasItems: this.recommendationsState.products.length > 0,\n      products: this.subsetRecommendations,\n    };\n  }\n\n  private validateProductsPerPage() {\n    const msg = new NumberValue({\n      min: 1,\n    }).validate(this.productsPerPage!);\n\n    if (msg) {\n      this.error = new Error(`The \"productsPerPage\" is invalid: ${msg}`);\n    }\n  }\n\n  private validateSlotID() {\n    const recListWithRecommendation = document.querySelectorAll(\n      `atomic-commerce-recommendation-list[slot-id=\"${this.slotId}\"]`\n    );\n\n    if (recListWithRecommendation.length > 1) {\n      this.bindings.engine.logger.warn(\n        `There are multiple atomic-commerce-recommendation-list in this page with the same slot-id property \"${this.slotId}\". Make sure to set a different recommendation property for each.`\n      );\n    }\n  }\n\n  private renderHeading() {\n    if (!this.augmentedRecommendationListState.headline) {\n      return;\n    }\n    if (this.augmentedRecommendationListState.hasError) {\n      return;\n    }\n\n    return (\n      <Heading level={this.headingLevel} part=\"label\" class=\"m-0 mb-2\">\n        {this.bindings.i18n.t(this.recommendationsState.headline)}\n      </Heading>\n    );\n  }\n\n  private get currentIndex() {\n    return Math.abs(\n      (this.currentPage * this.productsPerPage!) %\n        this.recommendationsState.products.length\n    );\n  }\n\n  private get subsetRecommendations() {\n    if (!this.productsPerPage) {\n      return this.recommendationsState.products;\n    }\n\n    return this.recommendationsState.products.slice(\n      this.currentIndex,\n      this.currentIndex + this.productsPerPage\n    );\n  }\n\n  private get numberOfPages() {\n    return Math.ceil(\n      this.recommendationsState.products.length / this.productsPerPage!\n    );\n  }\n\n  private get hasPagination() {\n    return this.numberOfPages > 1;\n  }\n\n  private get shouldRenderPagination() {\n    return this.hasPagination && this.augmentedRecommendationListState.hasItems;\n  }\n\n  private get hasNoProducts() {\n    return (\n      !this.recommendationsState.isLoading &&\n      this.augmentedRecommendationListState.products.length === 0\n    );\n  }\n\n  private logWarningIfNeeded(message?: string) {\n    if (message) {\n      this.bindings.engine.logger.warn(message);\n    }\n  }\n\n  private getAtomicProductProps(product: Product) {\n    const linkContent =\n      this.productTemplateProvider.getLinkTemplateContent(product);\n\n    return {\n      interactiveProduct: this.recommendations.interactiveProduct({\n        options: {product},\n      }),\n      product: product,\n      renderingFunction: this.itemRenderingFunction,\n      loadingFlag: this.loadingFlag,\n      key: this.itemListCommon.getResultId(\n        product.permanentid,\n        this.recommendationsState.responseId,\n        this.density,\n        this.imageSize\n      ),\n      content: this.productTemplateProvider.getTemplateContent(product),\n      linkContent,\n      stopPropagation: !!linkContent,\n      store: this.bindings.store,\n      density: this.density,\n      display: this.display,\n      imageSize: this.imageSize,\n    };\n  }\n\n  private computeListDisplayClasses() {\n    const displayPlaceholders = !this.isAppLoaded;\n\n    return getItemListDisplayClasses(\n      'grid',\n      this.density,\n      this.imageSize,\n      this.recommendationsState.isLoading,\n      displayPlaceholders\n    );\n  }\n\n  private renderAsGrid(product: Product, i: number) {\n    const propsForAtomicProduct = this.getAtomicProductProps(product);\n    const {interactiveProduct} = propsForAtomicProduct;\n    return (\n      <DisplayGrid\n        selectorForItem=\"atomic-product\"\n        item={{\n          ...product,\n          clickUri: product.clickUri,\n          title: product.ec_name ?? '',\n        }}\n        select={() => {\n          this.logWarningIfNeeded(interactiveProduct.warningMessage);\n          interactiveProduct.select();\n        }}\n        beginDelayedSelect={() => {\n          this.logWarningIfNeeded(interactiveProduct.warningMessage);\n          interactiveProduct.beginDelayedSelect();\n        }}\n        cancelPendingSelect={() => {\n          this.logWarningIfNeeded(interactiveProduct.warningMessage);\n          interactiveProduct.cancelPendingSelect();\n        }}\n        setRef={(element) =>\n          element && this.itemListCommon.setNewResultRef(element, i)\n        }\n      >\n        <atomic-product {...propsForAtomicProduct}></atomic-product>\n      </DisplayGrid>\n    );\n  }\n\n  private renderRecommendationList() {\n    this.itemListCommon.updateBreakpoints();\n    const listClasses = this.computeListDisplayClasses();\n\n    if (\n      !this.productTemplateRegistered ||\n      this.productTemplateProvider.hasError ||\n      this.error\n    ) {\n      return;\n    }\n\n    return (\n      <DisplayWrapper listClasses={listClasses} display=\"grid\">\n        <ResultsPlaceholdersGuard\n          density={this.density}\n          display={this.display}\n          imageSize={this.imageSize}\n          displayPlaceholders={!this.isAppLoaded}\n          numberOfPlaceholders={\n            this.productsPerPage ?? this.recommendationsState.products.length\n          }\n        ></ResultsPlaceholdersGuard>\n        <ItemDisplayGuard {...this.augmentedRecommendationListState}>\n          {this.subsetRecommendations.map((recommendation, i) => {\n            return this.renderAsGrid(recommendation, i);\n          })}\n        </ItemDisplayGuard>\n      </DisplayWrapper>\n    );\n  }\n\n  public render() {\n    if (this.hasNoProducts) {\n      this.bindings.store.unsetLoadingFlag(this.loadingFlag);\n      return <Hidden></Hidden>;\n    }\n    return (\n      <Fragment>\n        {this.renderHeading()}\n        {this.shouldRenderPagination ? (\n          <Carousel\n            bindings={this.bindings}\n            currentPage={this.currentPage}\n            nextPage={() => this.nextPage()}\n            previousPage={() => this.previousPage()}\n            numberOfPages={this.numberOfPages}\n          >\n            <div class=\"px-3\">{this.renderRecommendationList()}</div>\n          </Carousel>\n        ) : (\n          this.renderRecommendationList()\n        )}\n      </Fragment>\n    );\n  }\n}\n"],"version":3}