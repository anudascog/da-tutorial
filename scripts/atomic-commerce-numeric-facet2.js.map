{"file":"atomic-commerce-numeric-facet2.js","mappings":"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","names":[],"sources":["src/components/commerce/facets/atomic-commerce-numeric-facet/atomic-commerce-numeric-facet.pcss?tag=atomic-commerce-numeric-facet&encapsulation=shadow","src/components/commerce/facets/atomic-commerce-numeric-facet/atomic-commerce-numeric-facet.tsx"],"sourcesContent":["@import '../../../common/facets/numeric-facet-common.pcss';\n","import {\n  NumericFacet,\n  NumericFacetState,\n  NumericRangeRequest,\n  ProductListingSummaryState,\n  SearchSummaryState,\n  Summary,\n  Context,\n  ContextState,\n  buildContext,\n} from '@coveo/headless/commerce';\nimport {Component, Element, h, Listen, Prop, State} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {FocusTargetController} from '../../../../utils/stencil-accessibility-utils';\nimport {FacetInfo} from '../../../common/facets/facet-common-store';\nimport {FacetContainer} from '../../../common/facets/facet-container/stencil-facet-container';\nimport {FacetGuard} from '../../../common/facets/facet-guard';\nimport {FacetHeader} from '../../../common/facets/facet-header/stencil-facet-header';\nimport {NumericFacetValueLink} from '../../../common/facets/numeric-facet/value-link';\nimport {NumericFacetValuesContainer} from '../../../common/facets/numeric-facet/values-container';\nimport {initializePopover} from '../../../common/facets/popover/popover-type';\nimport {shouldDisplayInputForFacetRange} from '../../../common/facets/stencil-facet-common';\nimport {\n  defaultCurrencyFormatter,\n  defaultNumberFormatter,\n} from '../../../common/formats/format-common';\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport type {Range} from '../facet-number-input/atomic-commerce-facet-number-input';\n\n/**\n * The `atomic-commerce-numeric-facet` component is responsible for rendering a commerce facet that allows the user to filter products using numeric ranges.\n *\n * @alpha\n */\n@Component({\n  tag: 'atomic-commerce-numeric-facet',\n  styleUrl: './atomic-commerce-numeric-facet.pcss',\n  shadow: true,\n})\nexport class AtomicCommerceNumericFacet\n  implements InitializableComponent<Bindings>\n{\n  @InitializeBindings() public bindings!: Bindings;\n  @Element() private host!: HTMLElement;\n\n  @BindStateToController('facet')\n  @State()\n  public facetState!: NumericFacetState;\n\n  @BindStateToController('summary')\n  @State()\n  public summaryState!: SearchSummaryState | ProductListingSummaryState;\n\n  public context!: Context;\n  @BindStateToController('context') contextState!: ContextState;\n\n  @State() public error!: Error;\n\n  private manualRanges: (NumericRangeRequest & {label?: string})[] = [];\n\n  /**\n   * The Summary controller instance.\n   */\n  @Prop() summary!: Summary<SearchSummaryState | ProductListingSummaryState>;\n  /**\n   * The numeric facet controller instance.\n   */\n  @Prop({reflect: true}) public facet!: NumericFacet;\n  /**\n   * Specifies whether the facet is collapsed.\n   */\n  @Prop({reflect: true, mutable: true}) public isCollapsed = false;\n  /**\n   * The field identifier for this facet.\n   */\n  @Prop({reflect: true}) field?: string;\n\n  private headerFocus?: FocusTargetController;\n\n  private get focusTarget(): FocusTargetController {\n    if (!this.headerFocus) {\n      this.headerFocus = new FocusTargetController(this);\n    }\n    return this.headerFocus;\n  }\n\n  private unsubscribeFacetController?: () => void | undefined;\n\n  public initialize() {\n    if (!this.facet) {\n      return;\n    }\n\n    this.context = buildContext(this.bindings.engine);\n    this.ensureSubscribed();\n    this.registerFacetToStore();\n  }\n\n  public connectedCallback() {\n    this.ensureSubscribed();\n  }\n\n  public disconnectedCallback() {\n    this.unsubscribeFacetController?.();\n    this.unsubscribeFacetController = undefined;\n  }\n\n  private get formatter() {\n    if (this.field === 'ec_price' || this.field === 'ec_promo_price') {\n      return defaultCurrencyFormatter(this.contextState.currency);\n    }\n    return defaultNumberFormatter;\n  }\n\n  private registerFacetToStore() {\n    const {facetId} = this.facetState;\n    const facetInfo: FacetInfo = {\n      label: () => this.bindings.i18n.t(this.displayName),\n      facetId: facetId,\n      element: this.host,\n      isHidden: () => this.isHidden,\n    };\n\n    initializePopover(this.host, {\n      ...facetInfo,\n      hasValues: () => this.hasValues,\n      numberOfActiveValues: () => this.numberOfSelectedValues,\n    });\n  }\n\n  @Listen('atomic/numberInputApply')\n  public applyNumberInput({detail}: CustomEvent<Range>) {\n    const {start, end} = detail;\n    this.facet.setRanges([\n      {\n        start,\n        end,\n        endInclusive: true,\n        state: 'selected',\n      },\n    ]);\n  }\n\n  public render() {\n    const {\n      bindings: {i18n},\n    } = this;\n    const {firstRequestExecuted, hasError} = this.summaryState;\n    return (\n      <FacetGuard\n        enabled={true}\n        firstSearchExecuted={firstRequestExecuted}\n        hasError={hasError}\n        hasResults={this.shouldRenderFacet}\n      >\n        {\n          <FacetContainer>\n            <FacetHeader\n              i18n={i18n}\n              label={this.displayName}\n              onClearFilters={() => {\n                this.focusTarget.focusAfterSearch();\n                this.facet.deselectAll();\n              }}\n              numberOfActiveValues={this.numberOfSelectedValues}\n              isCollapsed={this.isCollapsed}\n              headingLevel={0}\n              onToggleCollapse={() => (this.isCollapsed = !this.isCollapsed)}\n              headerRef={(el) => this.focusTarget.setTarget(el)}\n            />\n            {!this.isCollapsed && [\n              this.shouldRenderValues && this.renderValues(),\n              this.shouldRenderInput && (\n                <atomic-commerce-facet-number-input\n                  bindings={this.bindings}\n                  label={this.displayName}\n                  facet={this.facet}\n                  range={this.facetState.manualRange}\n                ></atomic-commerce-facet-number-input>\n              ),\n            ]}\n          </FacetContainer>\n        }\n      </FacetGuard>\n    );\n  }\n\n  private renderValues() {\n    const {\n      manualRanges,\n      displayName,\n      bindings: {\n        i18n,\n        engine: {logger},\n      },\n      formatter,\n    } = this;\n\n    return (\n      <NumericFacetValuesContainer i18n={i18n} label={displayName}>\n        {this.valuesToRender.map((value) => (\n          <NumericFacetValueLink\n            formatter={formatter}\n            displayValuesAs={'checkbox'}\n            facetValue={value}\n            field={this.facetState.field}\n            i18n={i18n}\n            logger={logger}\n            manualRanges={manualRanges}\n            onClick={() => this.facet.toggleSelect(value)}\n          />\n        ))}\n      </NumericFacetValuesContainer>\n    );\n  }\n\n  private get displayName() {\n    return this.facetState.displayName || 'no-label';\n  }\n\n  private get numberOfSelectedValues() {\n    return (\n      this.facetState.values.filter(({state}) => state === 'selected').length ||\n      0\n    );\n  }\n\n  private get hasInputRange() {\n    return !!this.facetState.manualRange || this.summaryState.isLoading;\n  }\n\n  private get shouldRenderValues() {\n    return !this.hasInputRange && !!this.valuesToRender.length;\n  }\n\n  private get valuesToRender() {\n    return (\n      this.facetState.values.filter(\n        (value) => value.numberOfResults || value.state !== 'idle'\n      ) || []\n    );\n  }\n\n  private get shouldRenderInput() {\n    const {\n      firstRequestExecuted: firstSearchExecuted,\n      hasError,\n      isLoading,\n      hasProducts: hasResults,\n    } = this.summaryState;\n    return shouldDisplayInputForFacetRange({\n      hasInputRange: this.hasInputRange,\n      searchStatusState: {\n        firstSearchExecuted,\n        hasError,\n        hasResults,\n        isLoading,\n      },\n      facetValues: this.facetState.values,\n      hasInput: true,\n    });\n  }\n\n  private get isHidden() {\n    return !this.shouldRenderFacet;\n  }\n\n  private get shouldRenderFacet() {\n    return this.shouldRenderInput || this.shouldRenderValues;\n  }\n\n  private get hasValues() {\n    if (this.facetState.values.length) {\n      return true;\n    }\n\n    return !!this.valuesToRender.length;\n  }\n\n  private ensureSubscribed() {\n    if (this.unsubscribeFacetController) {\n      return;\n    }\n    this.unsubscribeFacetController = this.facet.subscribe(\n      () => (this.facetState = this.facet.state)\n    );\n  }\n}\n"],"version":3}