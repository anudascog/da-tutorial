{"version":3,"names":["atomicProductPriceCss","AtomicProductPriceStyle0","AtomicProductPrice","initialize","this","context","buildContext","bindings","engine","formatValue","value","currency","contextState","formatter","defaultCurrencyFormatter","i18n","languages","error","toString","parse","field","parseValue","product","getFormattedValue","hasPromotionalPrice","ec_promo_price","ec_price","render","mainPrice","originalPrice","h","Host","key","class","__decorate","InitializeBindings","ProductContext","BindStateToController"],"sources":["src/components/commerce/product-template-components/atomic-product-price/atomic-product-price.pcss?tag=atomic-product-price","src/components/commerce/product-template-components/atomic-product-price/atomic-product-price.tsx"],"sourcesContent":[".display-grid {\n  & atomic-product-price {\n    display: flex;\n    flex-wrap: wrap;\n    flex-direction: column;\n\n    & .original-price {\n      line-height: 1;\n    }\n  }\n}\n","import {\n  buildContext,\n  Product,\n  Context,\n  ContextState,\n} from '@coveo/headless/commerce';\nimport {Component, h, Host} from '@stencil/core';\nimport {\n  BindStateToController,\n  InitializableComponent,\n  InitializeBindings,\n} from '../../../../utils/initialization-utils';\nimport {defaultCurrencyFormatter} from '../../../common/formats/format-common';\nimport {CommerceBindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\nimport {ProductContext} from '../product-template-decorators';\nimport {parseValue} from '../product-utils';\n\n/**\n * @alpha\n * The `atomic-product-price` component renders the price of a product.\n */\n@Component({\n  tag: 'atomic-product-price',\n  styleUrl: 'atomic-product-price.pcss',\n  shadow: false,\n})\nexport class AtomicProductPrice\n  implements InitializableComponent<CommerceBindings>\n{\n  @InitializeBindings() public bindings!: CommerceBindings;\n  public error!: Error;\n\n  @ProductContext() private product!: Product;\n  public context!: Context;\n  @BindStateToController('context') contextState!: ContextState;\n\n  public initialize(): void {\n    this.context = buildContext(this.bindings.engine);\n  }\n\n  private formatValue(value: number) {\n    try {\n      const {currency} = this.contextState;\n      const formatter = defaultCurrencyFormatter(currency);\n      return formatter(value, this.bindings.i18n.languages as string[]);\n    } catch (error) {\n      this.error = error as Error;\n      return value.toString();\n    }\n  }\n\n  private parse(field: string) {\n    try {\n      return parseValue(this.product, field);\n    } catch (error) {\n      this.error = error as Error;\n      return null;\n    }\n  }\n\n  private getFormattedValue(field: string) {\n    const value = this.parse(field);\n    if (value !== null) {\n      return this.formatValue(value);\n    }\n  }\n\n  private get hasPromotionalPrice() {\n    return (\n      this.product.ec_promo_price !== null &&\n      this.product.ec_price !== null &&\n      this.product.ec_promo_price < this.product.ec_price\n    );\n  }\n\n  public render() {\n    const mainPrice = this.getFormattedValue(\n      this.hasPromotionalPrice ? 'ec_promo_price' : 'ec_price'\n    );\n\n    const originalPrice = this.hasPromotionalPrice\n      ? this.getFormattedValue('ec_price')\n      : null;\n\n    return (\n      <Host class=\"flex flex-wrap gap-1\">\n        <div\n          class={`truncate break-keep ${this.hasPromotionalPrice && 'text-error'}`}\n        >\n          {mainPrice}\n        </div>\n\n        <div\n          class={\n            'original-price content-center truncate text-xl break-keep line-through' +\n            (!originalPrice ? ' invisible' : '')\n          }\n        >\n          {originalPrice ?? 'â€‹'}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"oaAAA,MAAMA,EAAwB,yJAC9B,MAAAC,EAAeD,E,iXCyBFE,EAAkB,M,yBAUtB,UAAAC,GACLC,KAAKC,QAAUC,EAAaF,KAAKG,SAASC,O,CAGpC,WAAAC,CAAYC,GAClB,IACE,MAAMC,SAACA,GAAYP,KAAKQ,aACxB,MAAMC,EAAYC,EAAyBH,GAC3C,OAAOE,EAAUH,EAAON,KAAKG,SAASQ,KAAKC,U,CAC3C,MAAOC,GACPb,KAAKa,MAAQA,EACb,OAAOP,EAAMQ,U,EAIT,KAAAC,CAAMC,GACZ,IACE,OAAOC,EAAWjB,KAAKkB,QAASF,E,CAChC,MAAOH,GACPb,KAAKa,MAAQA,EACb,OAAO,I,EAIH,iBAAAM,CAAkBH,GACxB,MAAMV,EAAQN,KAAKe,MAAMC,GACzB,GAAIV,IAAU,KAAM,CAClB,OAAON,KAAKK,YAAYC,E,EAI5B,uBAAYc,GACV,OACEpB,KAAKkB,QAAQG,iBAAmB,MAChCrB,KAAKkB,QAAQI,WAAa,MAC1BtB,KAAKkB,QAAQG,eAAiBrB,KAAKkB,QAAQI,Q,CAIxC,MAAAC,GACL,MAAMC,EAAYxB,KAAKmB,kBACrBnB,KAAKoB,oBAAsB,iBAAmB,YAGhD,MAAMK,EAAgBzB,KAAKoB,oBACvBpB,KAAKmB,kBAAkB,YACvB,KAEJ,OACEO,EAACC,EAAI,CAAAC,IAAA,2CAACC,MAAM,wBACVH,EAAA,OAAAE,IAAA,2CACEC,MAAO,uBAAuB7B,KAAKoB,qBAAuB,gBAEzDI,GAGHE,EAAA,OAAAE,IAAA,2CACEC,MACE,2EACEJ,EAAgB,aAAe,KAGlCA,GAAiB,K,GArEGK,EAAA,CAA5BC,K,+BAGyBD,EAAA,CAAzBE,K,8BAEiCF,EAAA,CAAjCG,EAAsB,Y","ignoreList":[]}