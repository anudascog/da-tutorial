{"file":"atomic-insight-user-actions-session2.js","mappings":"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","names":[],"sources":["src/components/insight/user-actions/atomic-insight-user-actions-session/user-action.tsx","src/components/insight/user-actions/atomic-insight-user-actions-session/atomic-insight-user-actions-session.pcss?tag=atomic-insight-user-actions-session&encapsulation=shadow","src/components/insight/user-actions/atomic-insight-user-actions-session/atomic-insight-user-actions-session.tsx"],"sourcesContent":["import {UserAction as IUserAction} from '@coveo/headless/insight';\nimport {FunctionalComponent, h} from '@stencil/core';\nimport BookmarkIcon from '../../../../images/bookmark.svg';\nimport DocumentIcon from '../../../../images/document.svg';\nimport PointIcon from '../../../../images/point.svg';\nimport QuickviewIcon from '../../../../images/quickview.svg';\nimport SearchIcon from '../../../../images/search.svg';\nimport {parseTimestampToDateDetails} from '../../../../utils/date-utils';\nimport {InsightBindings} from '../../atomic-insight-interface/atomic-insight-interface';\n\nconst icons = {\n  SEARCH: SearchIcon,\n  CLICK: DocumentIcon,\n  VIEW: QuickviewIcon,\n  CUSTOM: PointIcon,\n  TICKET_CREATION: BookmarkIcon,\n};\n\ninterface UserAction {\n  action: IUserAction;\n  bindings: InsightBindings;\n}\n\nexport const UserAction: FunctionalComponent<UserAction> = ({\n  bindings,\n  action,\n}) => {\n  const renderActionTimestamp = () => {\n    const {hours, minutes} = parseTimestampToDateDetails(action.timestamp);\n\n    const formattedHours = String(hours).padStart(2, '0');\n    const formattedMinutes = String(minutes).padStart(2, '0');\n\n    return `${formattedHours}:${formattedMinutes}`;\n  };\n\n  const renderIcon = () => {\n    const iconClasses = `w-3 h-3 ${['CLICK', 'VIEW'].includes(action.actionType) ? 'text-primary' : ''}`;\n\n    return (\n      <atomic-icon\n        icon={icons[action.actionType]}\n        class={iconClasses}\n      ></atomic-icon>\n    );\n  };\n\n  const renderActionTitle = () => {\n    switch (action.actionType) {\n      case 'TICKET_CREATION':\n        return (\n          <div class=\"ticket-creation-action__text text-xs font-semibold\">\n            {bindings.i18n.t('ticket-created')}\n          </div>\n        );\n      case 'CUSTOM':\n        return (\n          <div class=\"text-xs font-semibold\">\n            {action.eventData?.value ?? action.eventData?.type}\n          </div>\n        );\n      case 'SEARCH':\n        return (\n          <div class=\"text-xs font-semibold\">\n            {action.query || bindings.i18n.t('empty-search')}\n          </div>\n        );\n      case 'VIEW':\n        return (\n          <a\n            href={action.document?.contentIdValue}\n            class=\"text-primary text-xs font-semibold\"\n            target=\"_blank\"\n          >\n            {action.document?.title}\n          </a>\n        );\n      case 'CLICK':\n        return (\n          <div class=\"text-xs font-semibold\">{action.document?.title}</div>\n        );\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <div class=\"flex\">\n      <div class=\"flex-none pr-2\">\n        <div class=\"flex justify-center py-1\">{renderIcon()}</div>\n        <div class=\"flex justify-center py-1\">\n          <div class=\"user-action__separator h-7 w-0.5 rounded\"></div>\n        </div>\n      </div>\n      <div class=\"flex-1\">\n        {renderActionTitle()}\n        <div class=\"text-neutral-dark text-xxs flex py-2 font-light\">\n          <div>{renderActionTimestamp()}</div>\n          <div class=\"px-2\">{action.searchHub}</div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","@import '../../../../global/global.pcss';\n\n.session-start-icon__container {\n  background-color: #fbb439;\n}\n\n.user-action__separator {\n  @apply bg-neutral;\n}\n\n.ticket-creation-action__text {\n  @apply text-success;\n}\n\n.text-xxs {\n  font-size: 0.625rem;\n}\n","import {UserAction as IUserAction} from '@coveo/headless/insight';\nimport {Component, h, Prop, Watch, State} from '@stencil/core';\nimport Flag from '../../../../images/flag.svg';\nimport ThreeDotsIcon from '../../../../images/three-dots.svg';\nimport {parseTimestampToDateDetails} from '../../../../utils/date-utils';\nimport {InitializeBindings} from '../../../../utils/initialization-utils';\nimport {Button} from '../../../common/stencil-button';\nimport {InsightBindings} from '../../atomic-insight-interface/atomic-insight-interface';\nimport {UserAction} from './user-action';\n\nexport type UserActionType =\n  | 'SEARCH'\n  | 'CLICK'\n  | 'TICKET_CREATION'\n  | 'VIEW'\n  | 'CUSTOM';\n\n/**\n * @internal\n * The `AtomicInsightUserActionSession` component displays all the user actions that took place during a specific user session.\n * @category Insight Panel\n * @example\n * <atomic-insight-user-actions-session userActions={actions} startTimestamp={1723035731}></atomic-insight-user-actions-session>\n */\n@Component({\n  tag: 'atomic-insight-user-actions-session',\n  styleUrl: 'atomic-insight-user-actions-session.pcss',\n  shadow: true,\n})\nexport class AtomicInsightUserActionsSession {\n  @InitializeBindings() public bindings!: InsightBindings;\n  @State() public error!: Error;\n\n  /**\n   * The start time of the session as a Unix timestamp.\n   */\n  @Prop() public startTimestamp!: number;\n  /**\n   * The list of user actions performed during the session.\n   */\n  @Prop() public userActions!: Array<IUserAction>;\n\n  private userActionsToDisplay: Array<IUserAction> = [];\n  private userActionsAfterCaseCreation: Array<IUserAction> = [];\n  @State() areActionsAfterCaseCreationVisible = false;\n\n  connectedCallback() {\n    this.prepareUserActionsToDisplay();\n  }\n\n  @Watch('userActions')\n  prepareUserActionsToDisplay() {\n    const caseCreationIndex = this.userActions.findIndex(\n      ({actionType}) => actionType === 'TICKET_CREATION'\n    );\n    const isCaseCreationSession = caseCreationIndex !== -1;\n\n    if (!isCaseCreationSession) {\n      this.userActionsToDisplay = this.userActions;\n      this.userActionsAfterCaseCreation = [];\n    } else {\n      this.userActionsToDisplay = this.userActions.slice(caseCreationIndex);\n      this.userActionsAfterCaseCreation = this.userActions.slice(\n        0,\n        caseCreationIndex\n      );\n    }\n  }\n\n  showActionsAfterCaseCreation() {\n    this.areActionsAfterCaseCreationVisible = true;\n  }\n\n  renderSessionStartDate() {\n    const caseCreationIndex = this.userActions.findIndex(\n      ({actionType}) => actionType === 'TICKET_CREATION'\n    );\n    const isCaseCreationSession = caseCreationIndex !== -1;\n\n    const {year, month, dayOfWeek, day} = parseTimestampToDateDetails(\n      this.startTimestamp\n    );\n\n    const formatedStartDate = `${dayOfWeek}. ${month} ${day}, ${year}`;\n    return (\n      <div class=\"flex items-center px-2 pb-3\">\n        {isCaseCreationSession ? (\n          <div class=\"session-start-icon__container mr-2 flex h-5 w-5 items-center justify-center rounded-full\">\n            <atomic-icon icon={Flag} class=\"h-3 w-3\"></atomic-icon>\n          </div>\n        ) : null}\n\n        <div class=\"flex-1 font-semibold\">{formatedStartDate}</div>\n      </div>\n    );\n  }\n\n  renderActions(actions: Array<IUserAction>) {\n    return (\n      <ol class=\"px-3\">\n        {actions?.map((action) => (\n          <UserAction action={action} bindings={this.bindings}></UserAction>\n        ))}\n      </ol>\n    );\n  }\n\n  renderShowMoreActionsButton() {\n    const btnClasses = 'flex items-center p-1 max-w-full';\n    const label = this.bindings.i18n.t('more-actions-in-session', {\n      count: this.userActionsAfterCaseCreation.length,\n    });\n    return (\n      <div\n        data-testid=\"show-more-actions-button\"\n        class=\"flex items-center px-3 pb-3\"\n      >\n        <div class=\"flex justify-center pr-2\">\n          <atomic-icon icon={ThreeDotsIcon} class=\"h-3 w-3\"></atomic-icon>\n        </div>\n        <div class=\"flex-1\">\n          <Button\n            style=\"text-primary\"\n            part=\"show-more-actions-button\"\n            class={btnClasses}\n            ariaLabel={label}\n            onClick={this.showActionsAfterCaseCreation.bind(this)}\n          >\n            <span class=\"truncate text-xs font-light\">{label}</span>\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  public render() {\n    const isShowMoreActionsButtonVisible =\n      !this.areActionsAfterCaseCreationVisible &&\n      !!this.userActionsAfterCaseCreation.length;\n\n    return (\n      <div>\n        {this.renderSessionStartDate()}\n\n        {this.areActionsAfterCaseCreationVisible && (\n          <div data-testid=\"more-actions-section\">\n            {this.renderActions(this.userActionsAfterCaseCreation)}\n          </div>\n        )}\n\n        {isShowMoreActionsButtonVisible && this.renderShowMoreActionsButton()}\n\n        {this.renderActions(this.userActionsToDisplay)}\n      </div>\n    );\n  }\n}\n"],"version":3}