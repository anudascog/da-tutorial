{"file":"init-queue-fbe942c3.js","mappings":"AAkBA,SAAS,SAAS;IAChB,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,SAAS,qBAAqB;IAC5B,IAAI,CAAC,SAAS,EAAE,CAAC,kBAAkB,EAAE;QACnC,SAAS,EAAE,CAAC,kBAAkB,GAAG;YAC/B,aAAa,EAAE,IAAI,GAAG,EAAE;YACxB,cAAc,EAAE,IAAI,GAAG,EAAE;SAC1B,CAAC;KACH;IACD,OAAO,SAAS,EAAE,CAAC,kBAAkB,CAAC;AACxC,CAAC;AAED,SAAS,gBAAgB;IACvB,OAAO,qBAAqB,EAAE,CAAC,aAAa,CAAC;AAC/C,CAAC;AAED,SAAS,iBAAiB;IACxB,OAAO,qBAAqB,EAAE,CAAC,cAAc,CAAC;AAChD,CAAC;SAEe,iBAAiB,CAAC,MAAe;IAC/C,MAAM,cAAc,GAAG,iBAAiB,EAAE,CAAC;IAC3C,cAAc,CAAC,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACjC,MAAM,aAAa,GAAG,gBAAgB,EAAE,CAAC;IACzC,MAAM,UAAU,GAAG,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;IACnD,UAAU,CAAC,OAAO,EAAE,CAAC;IACrB,OAAO,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;QAC5B,MAAM,EAAC,KAAK,EAAE,OAAO,EAAC,GAAG,UAAU,CAAC,GAAG,EAAG,CAAC;QAC3C,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;KAC9B;IACD,MAAM,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,oBAAoB,EAAE,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;IAC7E,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAC/B,CAAC;SAEe,aAAa,CAAC,MAAe;IAC3C,MAAM,cAAc,GAAG,iBAAiB,EAAE,CAAC;IAC3C,OAAO,cAAc,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC;AAC7C,CAAC;SAEe,mBAAmB,CACjC,MAAe,EACf,KAAsB,EACtB,OAAgB;IAEhB,MAAM,aAAa,GAAG,gBAAgB,EAAE,CAAC;IACzC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE;QAC9B,aAAa,CAAC,GAAG,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;KAC/B;IACD,aAAa,CAAC,GAAG,CAAC,MAAM,CAAE,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,OAAO,EAAC,CAAC,CAAC;AACpD,CAAC;SAEe,oCAAoC,CAClD,MAAe,EACf,KAAsB,EACtB,OAAgB;IAEhB,IAAI,aAAa,CAAC,MAAM,CAAC,EAAE;QACzB,OAAO,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;KAC9B;SAAM;QACL,mBAAmB,CAAC,MAAM,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;KAC7C;AACH;;;;","names":[],"sources":["src/utils/init-queue.ts"],"sourcesContent":["import {InitializeEventHandler} from './initialization-lit-stencil-common-utils';\n\nexport type InitializeEvent = CustomEvent<InitializeEventHandler>;\n\ndeclare global {\n  interface Window {\n    initQueueNamespace: {\n      eventQueueMap: Map<Element, QueuedEvent[]>;\n      parentReadyMap: Map<Element, boolean>;\n    };\n  }\n}\n\ntype QueuedEvent = {\n  event: InitializeEvent;\n  element: Element;\n};\n\nfunction getWindow() {\n  return window;\n}\n\nfunction getInitQueueNamespace() {\n  if (!getWindow().initQueueNamespace) {\n    getWindow().initQueueNamespace = {\n      eventQueueMap: new Map(),\n      parentReadyMap: new Map(),\n    };\n  }\n  return getWindow().initQueueNamespace;\n}\n\nfunction getEventQueueMap(): Map<Element, QueuedEvent[]> {\n  return getInitQueueNamespace().eventQueueMap;\n}\n\nfunction getParentReadyMap(): Map<Element, boolean> {\n  return getInitQueueNamespace().parentReadyMap;\n}\n\nexport function markParentAsReady(parent: Element) {\n  const parentReadyMap = getParentReadyMap();\n  parentReadyMap.set(parent, true);\n  const eventQueueMap = getEventQueueMap();\n  const eventQueue = eventQueueMap.get(parent) || [];\n  eventQueue.reverse();\n  while (eventQueue.length > 0) {\n    const {event, element} = eventQueue.pop()!;\n    element.dispatchEvent(event);\n  }\n  parent.dispatchEvent(new CustomEvent('atomic/parentReady', {bubbles: true}));\n  eventQueueMap.delete(parent);\n}\n\nexport function isParentReady(parent: Element): boolean {\n  const parentReadyMap = getParentReadyMap();\n  return parentReadyMap.get(parent) || false;\n}\n\nexport function queueEventForParent(\n  parent: Element,\n  event: InitializeEvent,\n  element: Element\n) {\n  const eventQueueMap = getEventQueueMap();\n  if (!eventQueueMap.has(parent)) {\n    eventQueueMap.set(parent, []);\n  }\n  eventQueueMap.get(parent)!.push({event, element});\n}\n\nexport function enqueueOrDispatchInitializationEvent(\n  parent: Element,\n  event: InitializeEvent,\n  element: Element\n) {\n  if (isParentReady(parent)) {\n    element.dispatchEvent(event);\n  } else {\n    queueEventForParent(parent, event, element);\n  }\n}\n"],"version":3}