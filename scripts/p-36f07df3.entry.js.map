{"version":3,"names":["atomicRecsResultCss","AtomicRecsResultStyle0","AtomicRecsResult","this","executedRenderingFunctionOnce","linkContent","DocumentFragment","display","density","imageSize","classes","handleClick","event","stopPropagation","host","shadowRoot","querySelector","click","resolveResult","preventDefault","detail","result","resolveInteractiveResult","interactiveResult","resolveStopPropagation","resolveResultDisplayConfig","connectedCallback","layout","ItemLayout","content","children","getContentHTML","parentNodeToString","getLinkHTML","isCustomRenderFunctionMode","renderingFunction","undefined","shouldExecuteRenderFunction","resultRootRef","render","h","Host","class","resultComponentClass","ref","linkContainerRef","getClasses","concat","join","innerHTML","componentDidLoad","loadingFlag","store","unsetLoadingFlag","componentDidRender","customRenderOutputAsString","className"],"sources":["src/components/recommendations/atomic-recs-result/atomic-recs-result.pcss?tag=atomic-recs-result&encapsulation=shadow","src/components/recommendations/atomic-recs-result/atomic-recs-result.tsx"],"sourcesContent":["@import '../../common/template-system/template-system.pcss';\n\n:host {\n  @apply atomic-template-system;\n}\n","import {\n  InteractiveResult as RecsInteractiveResult,\n  Result as RecsResult,\n} from '@coveo/headless/recommendation';\nimport {Component, h, Prop, Element, Listen, Host} from '@stencil/core';\nimport {parentNodeToString} from '../../../utils/dom-utils';\nimport {\n  InteractiveItemContextEvent,\n  ItemContextEvent,\n  DisplayConfig,\n} from '../../common/item-list/item-decorators';\nimport {\n  ItemRenderingFunction,\n  resultComponentClass,\n} from '../../common/item-list/stencil-item-list-common';\nimport {\n  ItemLayout,\n  ItemDisplayDensity,\n  ItemDisplayImageSize,\n  ItemDisplayLayout,\n} from '../../common/layout/display-options';\nimport {RecsStore} from '../atomic-recs-interface/store';\n\n/**\n * The `atomic-recs-result` component is used internally by the `atomic-recs-list` component.\n */\n@Component({\n  tag: 'atomic-recs-result',\n  styleUrl: 'atomic-recs-result.pcss',\n  shadow: true,\n})\nexport class AtomicRecsResult {\n  private layout!: ItemLayout;\n  private resultRootRef?: HTMLElement;\n  private linkContainerRef?: HTMLElement;\n  private executedRenderingFunctionOnce = false;\n  @Element() host!: HTMLElement;\n\n  /**\n   * Whether an atomic-result-link inside atomic-recs-result should stop click event propagation.\n   */\n  @Prop() stopPropagation?: boolean;\n\n  /**\n   * The result link to use when the result is clicked in a grid layout.\n   *\n   * @default - An `atomic-result-link` without any customization.\n   */\n  @Prop() linkContent: ParentNode = new DocumentFragment();\n\n  /**\n   * The result item.\n   */\n  @Prop() result!: RecsResult;\n\n  /**\n   * The InteractiveResult item.\n   * @internal\n   */\n  @Prop() interactiveResult!: RecsInteractiveResult;\n\n  /**\n   * Global Atomic state.\n   * @internal\n   */\n  @Prop() store?: RecsStore;\n\n  /**\n   * The result content to display.\n   */\n  @Prop() content?: ParentNode;\n\n  /**\n   * The layout to apply to display results.\n   */\n  @Prop() display: ItemDisplayLayout = 'list';\n\n  /**\n   * The size of the results.\n   */\n  @Prop() density: ItemDisplayDensity = 'normal';\n\n  /**\n   * The size of the visual section in result list items.\n   *\n   * This is overwritten by the image size defined in the result content, if it exists.\n   */\n  @Prop() imageSize: ItemDisplayImageSize = 'icon';\n\n  /**\n   * The classes to add to the result element.\n   */\n  @Prop() classes = '';\n\n  /**\n   * @internal\n   */\n  @Prop() loadingFlag?: string;\n\n  /**\n   * Internal function used by atomic-recs-list in advanced setups, which lets you bypass the standard HTML template system.\n   * Particularly useful for Atomic React\n   *\n   * @internal\n   */\n  @Prop() renderingFunction: ItemRenderingFunction;\n\n  @Listen('click')\n  public handleClick(event: MouseEvent) {\n    if (this.stopPropagation) {\n      event.stopPropagation();\n    }\n    this.host\n      .shadowRoot!.querySelector<HTMLAnchorElement>(\n        '.link-container > atomic-result-link a:not([slot])'\n      )\n      ?.click();\n  }\n\n  @Listen('atomic/resolveResult')\n  public resolveResult(event: ItemContextEvent<RecsResult>) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.detail(this.result);\n  }\n\n  @Listen('atomic/resolveInteractiveResult')\n  public resolveInteractiveResult(event: InteractiveItemContextEvent) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.detail(this.interactiveResult);\n  }\n\n  @Listen('atomic/resolveStopPropagation')\n  public resolveStopPropagation(event: CustomEvent) {\n    event.detail(this.stopPropagation);\n  }\n\n  @Listen('atomic/resolveResultDisplayConfig')\n  public resolveResultDisplayConfig(event: ItemContextEvent<DisplayConfig>) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.detail({\n      density: this.density,\n      imageSize: this.imageSize!,\n    });\n  }\n\n  public connectedCallback() {\n    this.layout = new ItemLayout(\n      this.content!.children,\n      this.display,\n      this.density,\n      this.imageSize\n    );\n  }\n\n  private getContentHTML() {\n    return parentNodeToString(this.content!);\n  }\n\n  private getLinkHTML() {\n    return parentNodeToString(this.linkContent);\n  }\n  private get isCustomRenderFunctionMode() {\n    return this.renderingFunction !== undefined;\n  }\n\n  private shouldExecuteRenderFunction() {\n    return (\n      this.isCustomRenderFunctionMode &&\n      this.resultRootRef &&\n      !this.executedRenderingFunctionOnce\n    );\n  }\n\n  public render() {\n    if (this.isCustomRenderFunctionMode) {\n      return (\n        <Host class={resultComponentClass}>\n          <div\n            class=\"result-root\"\n            ref={(ref) => (this.resultRootRef = ref)}\n          ></div>\n          <div\n            class=\"link-container\"\n            ref={(ref) => (this.linkContainerRef = ref)}\n          ></div>\n        </Host>\n      );\n    }\n    return (\n      // deepcode ignore ReactSetInnerHtml: This is not React code\n      <Host class={resultComponentClass}>\n        <div\n          class={`result-root ${this.layout\n            .getClasses()\n            .concat(this.classes)\n            .join(' ')}`}\n          innerHTML={this.getContentHTML()}\n        ></div>\n        <div class=\"link-container\" innerHTML={this.getLinkHTML()}></div>\n      </Host>\n    );\n  }\n\n  public componentDidLoad() {\n    if (this.loadingFlag && this.store) {\n      this.store.unsetLoadingFlag(this.loadingFlag);\n    }\n  }\n\n  public componentDidRender() {\n    if (this.shouldExecuteRenderFunction()) {\n      const customRenderOutputAsString = this.renderingFunction!(\n        this.result,\n        this.resultRootRef!,\n        this.linkContainerRef!\n      );\n\n      this.resultRootRef!.className += ` ${this.layout\n        .getClasses(customRenderOutputAsString)\n        .concat(this.classes)\n        .join(' ')}`;\n\n      this.executedRenderingFunctionOnce = true;\n    }\n  }\n}\n"],"mappings":"6UAAA,MAAMA,EAAsB,o4mcAC5B,MAAAC,EAAeD,E,MC8BFE,EAAgB,M,yBAInBC,KAAAC,8BAAgC,MAahCD,KAAAE,YAA0B,IAAIC,iBA2B9BH,KAAAI,QAA6B,OAK7BJ,KAAAK,QAA8B,SAO9BL,KAAAM,UAAkC,OAKlCN,KAAAO,QAAU,G,gDA5CgB,IAAIJ,iB,gHA2BD,O,aAKC,S,eAOI,O,aAKxB,G,4DAgBX,WAAAK,CAAYC,GACjB,GAAIT,KAAKU,gBAAiB,CACxBD,EAAMC,iB,CAERV,KAAKW,KACFC,WAAYC,cACX,uDAEAC,O,CAIC,aAAAC,CAAcN,GACnBA,EAAMO,iBACNP,EAAMC,kBACND,EAAMQ,OAAOjB,KAAKkB,O,CAIb,wBAAAC,CAAyBV,GAC9BA,EAAMO,iBACNP,EAAMC,kBACND,EAAMQ,OAAOjB,KAAKoB,kB,CAIb,sBAAAC,CAAuBZ,GAC5BA,EAAMQ,OAAOjB,KAAKU,gB,CAIb,0BAAAY,CAA2Bb,GAChCA,EAAMO,iBACNP,EAAMC,kBACND,EAAMQ,OAAO,CACXZ,QAASL,KAAKK,QACdC,UAAWN,KAAKM,W,CAIb,iBAAAiB,GACLvB,KAAKwB,OAAS,IAAIC,EAChBzB,KAAK0B,QAASC,SACd3B,KAAKI,QACLJ,KAAKK,QACLL,KAAKM,U,CAID,cAAAsB,GACN,OAAOC,EAAmB7B,KAAK0B,Q,CAGzB,WAAAI,GACN,OAAOD,EAAmB7B,KAAKE,Y,CAEjC,8BAAY6B,GACV,OAAO/B,KAAKgC,oBAAsBC,S,CAG5B,2BAAAC,GACN,OACElC,KAAK+B,4BACL/B,KAAKmC,gBACJnC,KAAKC,6B,CAIH,MAAAmC,GACL,GAAIpC,KAAK+B,2BAA4B,CACnC,OACEM,EAACC,EAAI,CAACC,MAAOC,GACXH,EAAA,OACEE,MAAM,cACNE,IAAMA,GAASzC,KAAKmC,cAAgBM,IAEtCJ,EAAA,OACEE,MAAM,iBACNE,IAAMA,GAASzC,KAAK0C,iBAAmBD,I,CAK/C,OAEEJ,EAACC,EAAI,CAACC,MAAOC,GACXH,EAAA,OACEE,MAAO,eAAevC,KAAKwB,OACxBmB,aACAC,OAAO5C,KAAKO,SACZsC,KAAK,OACRC,UAAW9C,KAAK4B,mBAElBS,EAAA,OAAKE,MAAM,iBAAiBO,UAAW9C,KAAK8B,gB,CAK3C,gBAAAiB,GACL,GAAI/C,KAAKgD,aAAehD,KAAKiD,MAAO,CAClCjD,KAAKiD,MAAMC,iBAAiBlD,KAAKgD,Y,EAI9B,kBAAAG,GACL,GAAInD,KAAKkC,8BAA+B,CACtC,MAAMkB,EAA6BpD,KAAKgC,kBACtChC,KAAKkB,OACLlB,KAAKmC,cACLnC,KAAK0C,kBAGP1C,KAAKmC,cAAekB,WAAa,IAAIrD,KAAKwB,OACvCmB,WAAWS,GACXR,OAAO5C,KAAKO,SACZsC,KAAK,OAER7C,KAAKC,8BAAgC,I","ignoreList":[]}