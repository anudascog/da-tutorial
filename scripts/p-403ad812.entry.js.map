{"version":3,"names":["atomicCommerceFacetNumberInputCss","AtomicCommerceFacetNumberInputStyle0","AtomicCommerceFacetNumberInput","connectedCallback","this","start","range","end","apply","startRef","validity","valid","endRef","applyInput","emit","absoluteMinimum","field","facet","state","isPriceField","includes","Number","MIN_SAFE_INTEGER","minimumInputValue","isUndefined","maximumInputValue","MAX_SAFE_INTEGER","render","facetId","label","bindings","i18n","t","minText","maxText","minAria","maxAria","applyAria","inputClasses","labelClasses","step","h","key","class","part","onSubmit","e","preventDefault","htmlFor","id","type","ref","required","min","max","value","onInput","target","valueAsNumber","Button","style","ariaLabel","text","FacetDateInput","rangeGetter","parseDate","toDate","undefined","componentDidUpdate","formattedDateValue","rangeRequest","buildDateRange","setHours","rangeSetter","date","format","startLabel","endLabel","startAria","endAria","placeholder","pattern"],"sources":["src/components/commerce/facets/facet-number-input/atomic-commerce-facet-number-input.pcss?tag=atomic-commerce-facet-number-input","src/components/commerce/facets/facet-number-input/atomic-commerce-facet-number-input.tsx","src/components/common/facets/facet-date-input/facet-date-input.tsx"],"sourcesContent":["[part='input-form'] {\n  display: grid;\n  grid-template-areas:\n    'label-start label-end .'\n    'input-start input-end apply-button';\n  grid-template-columns: 1fr 1fr auto;\n}\n\n[part='label-start'] {\n  grid-area: label-start;\n}\n[part='label-end'] {\n  grid-area: label-end;\n}\n[part='input-start'] {\n  grid-area: input-start;\n}\n[part='input-end'] {\n  grid-area: input-end;\n}\n\n[part='input-apply-button'] {\n  grid-area: apply-button;\n}\n","import {isUndefined} from '@coveo/bueno';\nimport {NumericFacet} from '@coveo/headless/commerce';\nimport {Component, h, Prop, Event, EventEmitter, State} from '@stencil/core';\nimport {Button} from '../../../common/stencil-button';\nimport {CommerceBindings as Bindings} from '../../atomic-commerce-interface/atomic-commerce-interface';\n\nexport type Range = {start: number; end: number};\n\n/**\n * Internal component made to be integrated in a NumericFacet.\n * @alpha\n */\n@Component({\n  tag: 'atomic-commerce-facet-number-input',\n  styleUrl: 'atomic-commerce-facet-number-input.pcss',\n  shadow: false,\n})\nexport class AtomicCommerceFacetNumberInput {\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @State() private start?: number;\n  @State() private end?: number;\n\n  @Prop() public bindings!: Bindings;\n  @Prop() public label!: string;\n  @Prop() public range?: Range;\n  @Prop() public facet!: NumericFacet;\n\n  @Event({\n    eventName: 'atomic/numberInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    this.start = this.range?.start;\n    this.end = this.range?.end;\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit({\n      start: this.start,\n      end: this.end,\n    });\n  }\n\n  private get absoluteMinimum(): number {\n    const {field} = this.facet.state;\n    const isPriceField = ['ec_price', 'ec_promo_price'].includes(field);\n    return isPriceField ? 0 : Number.MIN_SAFE_INTEGER;\n  }\n\n  private get minimumInputValue(): number {\n    return isUndefined(this.start) ? this.absoluteMinimum : this.start;\n  }\n\n  private get maximumInputValue() {\n    return isUndefined(this.end) ? Number.MAX_SAFE_INTEGER : this.end;\n  }\n\n  render() {\n    const {facetId} = this.facet.state;\n    const label = this.bindings.i18n.t(this.label);\n    const minText = this.bindings.i18n.t('min');\n    const maxText = this.bindings.i18n.t('max');\n    const minAria = this.bindings.i18n.t('number-input-minimum', {label});\n    const maxAria = this.bindings.i18n.t('number-input-maximum', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('number-input-apply', {label});\n\n    const inputClasses =\n      'p-2.5 input-primary placeholder-neutral-dark min-w-0 mr-1';\n    const labelClasses = 'text-neutral-dark text-sm';\n    const step = 'any';\n\n    return (\n      <form\n        class=\"mt-4 gap-y-0.5 px-2\"\n        part=\"input-form\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"label-start\"\n          class={labelClasses}\n          htmlFor={`${facetId}_start`}\n        >\n          {minText}\n        </label>\n        <input\n          part=\"input-start\"\n          id={`${facetId}_start`}\n          type=\"number\"\n          step={step}\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={minAria}\n          required\n          min={this.absoluteMinimum}\n          max={this.maximumInputValue}\n          value={this.range?.start}\n          onInput={(e) =>\n            (this.start = (e.target as HTMLInputElement).valueAsNumber)\n          }\n        />\n        <label part=\"label-end\" class={labelClasses} htmlFor={`${facetId}_end`}>\n          {maxText}\n        </label>\n        <input\n          part=\"input-end\"\n          id={`${facetId}_end`}\n          type=\"number\"\n          step={step}\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={maxAria}\n          required\n          min={this.minimumInputValue}\n          max={Number.MAX_SAFE_INTEGER}\n          value={this.range?.end}\n          onInput={(e) =>\n            (this.end = (e.target as HTMLInputElement).valueAsNumber)\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"flex-none truncate p-2.5\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n","import {\n  buildDateRange,\n  DateFilterRange,\n  DateRangeRequest,\n} from '@coveo/headless';\nimport {Component, h, State, Prop, Event, EventEmitter} from '@stencil/core';\nimport {parseDate} from '../../../../utils/date-utils';\nimport {Button} from '../../../common/stencil-button';\nimport {AnyBindings} from '../../interface/bindings';\n\n/**\n * Internal component made to be integrated in a TimeframeFacet.\n * @internal\n */\n@Component({\n  tag: 'atomic-facet-date-input',\n  shadow: false,\n})\nexport class FacetDateInput {\n  @State() private start?: Date;\n  @State() private end?: Date;\n  private startRef!: HTMLInputElement;\n  private endRef!: HTMLInputElement;\n\n  @Prop() public bindings!: AnyBindings;\n  @Prop() public rangeGetter!: () => DateFilterRange | undefined;\n  @Prop() public rangeSetter!: (range: DateRangeRequest) => void;\n  @Prop() public facetId!: string;\n  @Prop() public label!: string;\n  @Prop() public min?: string;\n  @Prop() public max?: string;\n\n  @Event({\n    eventName: 'atomic/dateInputApply',\n  })\n  private applyInput!: EventEmitter;\n\n  public connectedCallback() {\n    const range = this.rangeGetter();\n    this.start = range ? parseDate(range.start).toDate() : undefined;\n    this.end = range ? parseDate(range.end).toDate() : undefined;\n  }\n  public componentDidUpdate() {\n    if (!this.startRef.value && !this.endRef.value) {\n      this.startRef.min = this.min || this.formattedDateValue('1401-01-01');\n      this.endRef.max = this.max || '';\n      this.startRef.max = this.max || '';\n      this.endRef.min = this.min || '';\n    }\n  }\n\n  private apply() {\n    if (!this.startRef.validity.valid || !this.endRef.validity.valid) {\n      return;\n    }\n\n    this.applyInput.emit({\n      start: this.start,\n      end: this.end,\n    });\n\n    const rangeRequest = buildDateRange({\n      start: this.start!,\n      end: this.end!.setHours(23, 59, 59, 999),\n    });\n\n    this.rangeSetter(rangeRequest);\n  }\n\n  private formattedDateValue(date?: string | Date) {\n    if (!date) {\n      return '';\n    }\n    return parseDate(date).format('YYYY-MM-DD');\n  }\n\n  render() {\n    const label = this.bindings.i18n.t(this.label);\n    const startLabel = this.bindings.i18n.t('start');\n    const endLabel = this.bindings.i18n.t('end');\n    const startAria = this.bindings.i18n.t('date-input-start', {label});\n    const endAria = this.bindings.i18n.t('date-input-end', {label});\n    const apply = this.bindings.i18n.t('apply');\n    const applyAria = this.bindings.i18n.t('date-input-apply', {label});\n\n    const inputClasses = 'input-primary p-2.5';\n    const labelClasses = 'text-neutral-dark self-center';\n\n    const placeholder = 'yyyy-mm-dd';\n    // Fallback for Safari < 14.1, date with format yyyy-mm-dd over 1400 (API limit)\n    const pattern =\n      '^(1[4-9]\\\\d{2}|2\\\\d{3})-(0[1-9]|1[0-2])-(0[1-9]|[12]\\\\d|3[01])$';\n\n    const range = this.rangeGetter();\n\n    return (\n      <form\n        class=\"mt-4 grid grid-cols-[min-content_1fr] gap-2 px-2\"\n        onSubmit={(e) => {\n          e.preventDefault();\n          this.apply();\n          return false;\n        }}\n      >\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.facetId}_start`}\n        >\n          {startLabel}:\n        </label>\n        <input\n          id={`${this.facetId}_start`}\n          part=\"input-start\"\n          type=\"date\"\n          ref={(ref) => (this.startRef = ref!)}\n          class={inputClasses}\n          aria-label={startAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          // API/Index minimum supported date\n          min={this.min || this.formattedDateValue('1401-01-01')}\n          max={this.end ? this.formattedDateValue(this.end) : this.max}\n          value={this.formattedDateValue(range?.start)}\n          onInput={(e) =>\n            (this.start = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <label\n          part=\"input-label\"\n          class={labelClasses}\n          htmlFor={`${this.facetId}_end`}\n        >\n          {endLabel}:\n        </label>\n        <input\n          id={`${this.facetId}_end`}\n          part=\"input-end\"\n          type=\"date\"\n          ref={(ref) => (this.endRef = ref!)}\n          class={inputClasses}\n          aria-label={endAria}\n          placeholder={placeholder}\n          pattern={pattern}\n          required\n          min={this.formattedDateValue(this.start) || this.min}\n          max={this.max}\n          value={this.formattedDateValue(range?.end)}\n          onInput={(e) =>\n            (this.end = parseDate(\n              (e.target as HTMLInputElement).value\n            ).toDate())\n          }\n        />\n        <Button\n          style=\"outline-primary\"\n          type=\"submit\"\n          part=\"input-apply-button\"\n          class=\"col-span-2 truncate p-2.5\"\n          ariaLabel={applyAria}\n          text={apply}\n        ></Button>\n      </form>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}